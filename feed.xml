<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://www.devkoala.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.devkoala.com/" rel="alternate" type="text/html" /><updated>2024-07-01T22:21:39+02:00</updated><id>https://www.devkoala.com/feed.xml</id><title type="html">Dev Koala</title><entry><title type="html">Task Scheduler Guide</title><link href="https://www.devkoala.com/2024/task-scheduler-guide.html" rel="alternate" type="text/html" title="Task Scheduler Guide" /><published>2024-06-26T14:14:20+02:00</published><updated>2024-06-26T14:14:20+02:00</updated><id>https://www.devkoala.com/2024/task-scheduler-guide</id><content type="html" xml:base="https://www.devkoala.com/2024/task-scheduler-guide.html"><![CDATA[<h1 id="task-scheduler-guide">Task Scheduler Guide</h1>

<p>A decent tool since <em>Vista</em> but already existing as early as <em>Win 3.11</em>, Task Scheduler is an ireplaceable tool to manage system scripts.</p>

<p>As the name implies, it is the Windows version of Unix’s <em>Cron</em>. The software manages events that are executed at specified times. It’s essentially a calendar of tasks.</p>

<p>Setting up tasks is more cumbersome compared to Cron due to everything being done through a graphical interface. Instead of quickly writing a one-line rule with a path to a script, we have to navigate through multiple clicks.</p>

<p>On the other hand, Task Scheduler is more user-friendly. Unlike Cron, which requires explanation, a task in Task Scheduler can be created with minimal knowledge and research.</p>

<p>This makes it particularly useful in freelancing, where a client whose knowledge of PCs is limited can be easily guided through the setup process without becoming frustrated.</p>

<p>Another advantage is reliability: in Cron, scripts can sometimes run unpredictably, and troubleshooting may require technical knowledge and can be cumbersome. Task Scheduler is generally more reliable in this regard.</p>

<h2 id="starting-task-scheduler">Starting Task Scheduler</h2>

<p>The easiest way to start Task Scheduler is by pressing the Start button on your keyboard and then typing ‘task scheduler’. You don’t have to type the whole phrase, as the autofill will suggest it. Just press <em>Enter</em> when it appears.</p>

<p>For those who prefer keyboard shortcuts or want a more direct approach, you can press <em>Win+r</em> and type <em>‘taskschd.sc’</em> in the Run dialog that appears.</p>

<p>The initial screen might look like this, or somewhat similar, depending on which menu panels you have enabled or disabled:</p>

<p><img src="https://www.devkoala.com/assets/img/articles/task-scheduler-guide/taskschd1.png" alt="Task Scheduler main tab" /></p>

<p>Right off the bat, you can see some limitations in the interface. Sorting tasks by column used to work on Windows 10, but it may not function now (at least in my experience). There’s also no search functionality.</p>

<p>This means locating a single task when you have hundreds can be extremely problematic. After focusing on the table, you can type the name of the task you’re looking for and it will keep focusing first direct match, but if there are many tasks with near-identical names, it’s not very helpful.</p>

<h2 id="adding-a-new-task">Adding a new task</h2>

<p>There are two procedures for creating tasks:</p>

<ol>
  <li>
    <p><strong>Create Basic Task</strong> - A streamlined wizard with limited options that sets sensible defaults. This is designed for inexperienced users to avoid confusion.</p>
  </li>
  <li>
    <p><strong>Create Task</strong> - The full version with all options visible, taking slightly longer to set up but offering more control.</p>
  </li>
</ol>

<p>In this article, we’ll cover option 2, as it only takes about one to five minutes to fully grasp and some of the extra options are useful.</p>

<p>In the right <em>Actions</em> panel, click <em>Create Task</em>. Alternatively, in the top program menu, click <em>Action</em> and select <em>Create Task</em> from the dropdown menu.</p>

<h3 id="general">General</h3>

<p>A window similar to the one pictured below will appear. It has 5 tabs, defaulting to the first one, <em>General</em>. Here are explanations for all the options. The one marked with an exclamation mark (!) is required to set up before continuing.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/task-scheduler-guide/taskschd2.png" alt="Task Scheduler: Create Task: General" /></p>

<ul>
  <li>
    <p><strong>Name</strong>(!): Name of the task. Choose something concise yet descriptive enough that you’ll immediately know what the task does when you encounter it a year from now. Using unique initial letters makes it easier to find by typing.</p>
  </li>
  <li>
    <p><strong>Description</strong>: Self-explanatory. Here you can be as verbose as you like. Taking a moment to write a detailed description is worthwhile, especially if you plan to have many tasks.</p>
  </li>
  <li>
    <p><strong>When running the task, use the following user account</strong>: If the account which will be running the script is different from the currently logged-in account, you need to change it here.</p>
  </li>
  <li>
    <p><strong>Run only when user is logged in / Run whether user is logged in or not</strong>: Scripts that require user interaction or access to variables created during the log-in process need the first option. The second option hides the task execution and is more suitable for non-interactive background tasks. If unsure, leave it at the default first option.</p>
  </li>
  <li>
    <p><strong>Run with highest privileges</strong>: Enable this only if you know you need it. Otherwise, leave it off, as giving highest privileges to a script can cause significant problems if the script misbehaves.</p>
  </li>
  <li>
    <p><strong>Hidden</strong>: This option hides the task from the list of tasks. Use with caution and only when necessary for privacy or security reasons.</p>
  </li>
  <li>
    <p><strong>Configure for</strong>: Increases compatibility in some edge cases. It’s usually safe to leave this at the default setting.</p>
  </li>
</ul>

<h3 id="triggers">Triggers</h3>

<p>This is where Task Scheduler really shines and makes Crontab look like child’s toy.</p>

<p>Triggers are conditions which, when met, start the task. In most cases, tasks will have one trigger, but there are instances where multiple triggers are needed. It’s much more convenient to define multiple triggers than multiple tasks, each with a different trigger.</p>

<p>The most commonly used trigger, which is also the default, is <em>On the schedule</em>. We choose a specific date, or a daily/weekly/monthly cycle for the task to be executed.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/task-scheduler-guide/taskschd3.png" alt="Task Scheduler: Create Task: Triggers" /></p>

<p>Often, we want the script to run whenever the computer is on, without concerning ourselves with dates and cycles. We can choose to start the task at logon or startup.</p>

<p>A fantastic feature for power users and unique cases is <em>On an event</em>. For example, when a specific event is logged in the <em>Windows Event Viewer</em>, it could trigger our script to start.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/task-scheduler-guide/taskschd4.png" alt="Task Scheduler: Create Task: New trigger" /></p>

<p>Workstation lock/unlock triggers are very useful in work environments when we want certain scripts to run only when the workstation is in use.</p>

<p>As you can see, the possibilities with Task Scheduler Triggers are vast. Microsoft has made many questionable decisions in the directions its applications are going, but here they’ve done an excellent job.</p>

<p>Let’s discuss some of the <strong>Advanced settings</strong>:</p>

<ul>
  <li>
    <p><strong>Delay task for up to X</strong>: When the trigger registers, instead of starting the task immediately, Task Scheduler waits a specified amount of time before starting.</p>
  </li>
  <li>
    <p><strong>Repeat task every X for the duration of Y</strong>: When we want to start a script at system logon and then run every hour, choose <em>Begin a task: On a schedule</em> and select <em>Repeat task every: 1 hour</em>. If you want it to repeat indefinitely, make sure to select <em>For a duration of: Indefinitely</em>.</p>
  </li>
  <li>
    <p><strong>Stop Task if it runs longer than X</strong>: Very useful for poorly written scripts which tend to fail and then hang indefinitely, especially if they consume resources while doing so. When dealing with such problematic code, we can limit it with settings like 30 minutes. Note that you’re not limited to options in the drop-down list; you can enter custom values.</p>
  </li>
  <li>
    <p><strong>Expire</strong>: Another useful feature. We can have a script collecting data until publication of that data, at which point we want the script to be disabled until we start another data gathering session later in the year. It’s convenient to set up the task expiration date instead of having to remember to disable it manually.</p>
  </li>
  <li>
    <p><strong>Enabled</strong>: The most self-explanatory of all the options, but potentially troublesome. It can be clicked not only by clicking on the box or the name, but the clickable area extends to half of the entire container window width. This makes it possible to accidentally click and disable it, potentially causing confusion about why the task isn’t working.</p>
  </li>
</ul>

<h3 id="actions">Actions</h3>

<p>After going through various options and scheduling settings for our task, we now create the actual task that will be running.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/task-scheduler-guide/taskschd5.png" alt="Task Scheduler: Create Task: Actions" /></p>

<p>Here, everything is straightforward. We click on <em>Browse</em> and provide the location of the program to run. If we want to start a program with additional arguments, we specify them in the second field.</p>

<p>The third box, <em>Start in (optional)</em> provides a directory where the program will start. This will be the context directory, useful for example when the program uses relative paths and we want it to have access to files in that particular directory.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/task-scheduler-guide/taskschd6.png" alt="Task Scheduler: Create Task: New action" /></p>

<p>Another use is for log file generation. Starting in a specific directory could mean the script generates logs in that directory, which might be desired behavior.</p>

<h3 id="conditions">Conditions</h3>

<p>Conditions are an extra set of <em>if</em> statements guarding the task. If any condition is not met, the task is prevented from running.</p>

<p>All of the options are self-explanatory, so there’s no need to expand on any of them.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/task-scheduler-guide/taskschd7.png" alt="Task Scheduler: Create Task: Conditions" /></p>

<p>One particularly useful feature is <em>“Start only if the following network connection is available”</em>. This is especially useful for users in countries where high-speed internet access is not yet common. A PC could be connected to low-speed internet, and for a few hours of the day, high-speed internet could become available.</p>

<p>Task Scheduler could wait for the better option and only then execute the script to enable faster downloading of content. Another use case is waiting for a connection where there is no monthly download limit.</p>

<h3 id="settings">Settings</h3>

<ul>
  <li>
    <p><strong>Allow task to be run on demand</strong>: Enables manual execution of the task at any time via the Task Scheduler interface or command line. This is useful for creating extra backup runs of the script or when the script is still in a testing stage and we need to manually execute it to verify what is not working and why.</p>
  </li>
  <li>
    <p><strong>Run task as soon as possible after a scheduled start is missed</strong>: A crucial setting for all scripts handling backup. For example, if we schedule a backup at 10 AM but the system is off at that time, ticking this setting ensures that when the PC starts later that day, Task Scheduler recognizes that the backup script did not run and will execute it.</p>
  </li>
  <li>
    <p><strong>If the task fails, restart every [X] minutes, up to [Y] times</strong>: Enable this setting for network-related tasks, such as scripts that upload files to a server. If the task fails due to a temporary network issue, it will retry a few times before giving up, increasing the chances of success.</p>
  </li>
  <li>
    <p><strong>Stop the task if it runs longer than [X] hours and [Y] minutes</strong>: Enable this setting for scripts that perform resource-intensive calculations or data processing. If the script has a bug causing it to run indefinitely, this setting will prevent it from consuming system resources indefinitely.</p>
  </li>
  <li>
    <p><strong>If the running task does not end when requested, force it to stop</strong>: Enable this setting for tasks that interact with external systems, such as automated tests or data transfers. If these tasks hang due to unresponsive external systems, forcing them to stop prevents system resources from being tied up.</p>
  </li>
  <li>
    <p><strong>If the task is already running, then the following rule applies</strong>: A very useful set of conditions. When a script is scheduled to run every hour and the old instance hangs and consumes resources, these can stack up. If it doesn’t quit as expected and continues its work, after an hour we could have two scripts doing the same thing which, if they manipulate the same data simultaneously, can have catastrophic results. This setting provides safety nets for these and many other conditions.</p>
  </li>
</ul>

<h3 id="history">History</h3>

<p>Finally, we have the task execution history. It is disabled by default, but enabling it won’t significantly impact system performance. It won’t create logs that consume much disk space, won’t cause excessive disk I/O, and won’t consume much processing power.</p>

<p>The exception is when we have a very large number of tasks that run frequently, but these are very rare cases.</p>

<p>In general, when we are working on a complex system task whose development will take a while and it’s going to be executed many times during each working session, it is useful to enable history for easy execution status tracking.</p>

<h3 id="last-run-result">Last Run Result</h3>

<p>One poorly designed aspect of Task Scheduler is the execution codes, visible in the main task table.</p>

<p>Each time a task is executed, there is a code describing the status of that execution. Some of these statuses have both a hexadecimal code (0xnum) and a description, from which we can determine if it worked well and if not, why. However, other times we just receive the code and have to manually search the web to understand what happened with our task.</p>

<p>Below is a list of all the common execution codes and what they mean:</p>
<ul>
  <li><strong>0x0: Success</strong> - The task completed successfully without errors.</li>
  <li><strong>0x1: Incorrect function call</strong> - This often indicates a generic error with the function call within the script or program.</li>
  <li><strong>0x2: File not found</strong> - The script or program could not find a file it needs to execute.</li>
  <li><strong>0x41300: Task is ready to run at its next scheduled time</strong> - The task is correctly configured and will run at the next scheduled time.</li>
  <li><strong>0x41301: Task is currently running</strong> - The task is actively running.</li>
  <li><strong>0x41302: Task is disabled</strong> - The task needs to be manually enabled to run.</li>
  <li><strong>0x41303: Task has not yet run</strong> - The task has never been executed since it was created or last updated.</li>
  <li><strong>Task is running interactively as a different user</strong> - The task is running interactively under a different user account.</li>
  <li><strong>0x41305: Task is not running</strong> - The task is not currently running.</li>
  <li><strong>0x80070005: Access is denied</strong> - The task does not have the necessary permissions to execute.</li>
  <li><strong>0x8007010B: Directory name is invalid</strong> - The task points to a directory that is invalid or does not exist.</li>
  <li><strong>0xC000013A: The application was terminated by Ctrl+C</strong> - The task was terminated by the user manually.</li>
</ul>]]></content><author><name>Chris</name></author><category term="scheduler" /><category term="windows" /><summary type="html"><![CDATA[Task Scheduler Guide]]></summary></entry><entry><title type="html">Writing a local Windows audio scrobbler</title><link href="https://www.devkoala.com/2024/writing-a-local-windows-audio-scrobbler.html" rel="alternate" type="text/html" title="Writing a local Windows audio scrobbler" /><published>2024-02-15T14:13:00+01:00</published><updated>2024-02-15T14:13:00+01:00</updated><id>https://www.devkoala.com/2024/writing-a-local-windows-audio-scrobbler</id><content type="html" xml:base="https://www.devkoala.com/2024/writing-a-local-windows-audio-scrobbler.html"><![CDATA[<h1 id="writing-a-local-windows-audio-scrobbler">Writing a local Windows audio scrobbler</h1>

<p>The practice of listening to MP3 files and maintaining an MP3 collection is certainly a thing of the past now. In fact, if we asked a few tech-savvy teenagers what an MP3 file is, some wouldn’t even know.</p>

<p>Services such as Spotify and Tidal have replaced manually searching for, downloading, and cataloguing music, much like Netflix and Disney+ have obliterated the pay-per-view and rental VOD market.</p>

<p>As with every technology out there, there are a few dinosaurs who refuse to give up old habits for various reasons, the author of this blog being one of them.</p>

<p>Having a private collection of files offers the same benefits as general local storage offers over cloud solutions: instant direct access, ability to edit and cut out content with ease, no need for an internet connection, and more.</p>

<p>Local scrobbling perfectly compliments local playback. Last.fm, Libre.fm, and the like are nice while they last, but they are not profitable and therefore can be discontinued any day.</p>

<p>By writing a local scrobbling application, we have full control over which tag fields are logged and how the file looks. It can then be backed up with ease.</p>

<p>In this article, we’re going to write a scrobbling application using Python for the Windows operating system. It will run continuously while we are logged in. It will listen to changes in Foobar playback and log those changes to a file according to our specified logic.</p>

<p>A few years ago, I wrote another article that does the same thing for graphical Linux, using the DeaDBeeF player and written in Bash. If you need a Linux version, <a href="https://devkoala.com/2020/writing-a-local-audio-scrobbling-script-in-bash.html">here</a> is a link to the article.</p>

<h2 id="requirements">Requirements</h2>

<ol>
  <li><strong>Python</strong>. Python. This ever-popular programming language is a first choice when it comes to many tasks. Due to its simplicity and readability, it is certainly a joy to write in compared to most other languages.</li>
</ol>

<p>Download the latest Python version from the official Python website <a href="https://www.python.org/downloads/">here</a>.</p>

<ol>
  <li><strong>foobar 2000</strong>. One of the easiest ways to make a local audio scrobbling script is to monitor an audio player’s title string, extract data from it, manipulate it, and store it in a file. There aren’t that many MP3 players for Windows, let alone ones that allow us to manipulate their title. Of the very few, foobar2000 is the best, so it is our choice.</li>
</ol>

<p><a href="https://www.foobar2000.org/download">Here</a> is a link to the download section of the official foobar2000 website.</p>

<h2 id="configuring-foobar-2000">Configuring Foobar 2000</h2>

<p><img src="https://www.devkoala.com/assets/img/articles/writing-a-local-windows-audio-scrobbler/foobar2000-options.png" alt="Foobar setting location" /></p>

<p>The version I am using as of the time of writing this article is 2.1.4.</p>

<p>Go to <em>Preferences</em> by either pressing <em>Ctrl+p</em> or through <em>File -&gt; Preferences</em>. In the left menu tree select <em>Display</em>, then select <em>Default User Interface</em> under it.</p>

<p>In the <em>Playback state display formatting</em> section, you need to edit the <em>Window title</em> field. Replace whatever you find there with:</p>
<blockquote>
  <p><em>%artist% -.- %album% -.- %title% -.- %date% -.- %length% -.- %playback_time%</em></p>
</blockquote>

<p>As you can see, foobar2000 has many different tags encapsulated between percentage signs. Putting ‘ -.- ‘ is our choice. A distinct combination of strings has to be used so that the script can later extract data between them. Using the selected solution generally guarantees this. There is a very low chance that this particular string is going to appear in artist, album, or title tags.</p>

<p>On the other hand, it doesn’t look horrible (although it’s certainly not pretty), which is also important because if our Windows taskbar is configured to show icons and program titles instead of just icons, we are going to be looking at it every time the artist tag field of the currently played song in foobar2000 is short enough.</p>

<h2 id="breaking-apart-the-script">Breaking apart the script</h2>

<p>Let’s get down to it.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="n">pygetwindow</span> <span class="k">as</span> <span class="n">gw</span><span class="p">,</span> <span class="n">re</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">time</span> <span class="kn">import</span> <span class="n">sleep</span></code></pre></figure>

<p>The imports section is quite straightforward, befitting a miniscule script.</p>

<p><a href="https://pypi.org/project/PyGetWindow/">PyGetWindow</a> is the only module which is not built-in. Thanks to it, we get access to titles of all programs that are currently running. Download it from the command line with this command:</p>

<blockquote>
  <p>pip install pygetwindow</p>
</blockquote>

<p>Next, we define 3 functions to aid us in the audio scrobbling process:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_window_title_contains</span><span class="p">(</span><span class="n">partial_title</span><span class="p">):</span>
	<span class="n">windows</span> <span class="o">=</span> <span class="n">gw</span><span class="p">.</span><span class="nf">getAllTitles</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">partial_title</span> <span class="ow">in</span> <span class="n">title</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
			<span class="k">return</span> <span class="n">title</span></code></pre></figure>

<p>foobar2000 adds the string <em>’ [foobar2000]’</em> at the end of the program title, and it’s non-negotiable. Therefore, we have a convenient string to search for in order to isolate foobar2000 from other applications and get the playback data.</p>

<p>This function uses PyGetWindow to iterate through all the currently opened window titles and give us foobar2000.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">convert_minsec_to_sec</span><span class="p">(</span><span class="n">minsec</span><span class="p">):</span>
	<span class="n">seconds</span> <span class="o">=</span> <span class="n">minsec</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
	<span class="n">minutes</span> <span class="o">=</span> <span class="n">minsec</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
	<span class="n">seconds</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
	<span class="n">minutes</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">minutes</span><span class="p">)</span>
	<span class="n">seconds_full</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">minutes</span> <span class="o">+</span> <span class="n">seconds</span>
	<span class="k">return</span> <span class="n">seconds_full</span></code></pre></figure>

<p>In the script, playback time is important because we’re going to be constantly comparing the previously stored time with the current one in order to detect if the track has changed. To effectively do this comparison, it’s easiest to convert minutes to seconds by multiplying the value representing minutes by 60 and adding it to the value representing seconds.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">foobar_title_to_csv_stripe</span><span class="p">(</span><span class="n">foobar_title</span><span class="p">):</span>
	<span class="n">csv_ready</span> <span class="o">=</span> <span class="n">foobar_title</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> -.- </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">;</span><span class="sh">'</span><span class="p">)</span>
	<span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
	<span class="n">formatted_time</span> <span class="o">=</span> <span class="n">current_time</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y.%m.%d;%H:%M;</span><span class="sh">'</span><span class="p">)</span>
	<span class="n">stripe_pre</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">formatted_time</span><span class="si">}{</span><span class="n">csv_ready</span><span class="si">}</span><span class="sh">'</span><span class="p">[:</span><span class="o">-</span><span class="mi">14</span><span class="p">]</span>
	<span class="n">unwanted_string_tail</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">;\d?\d:\d\d$</span><span class="sh">"</span><span class="p">,</span> <span class="n">stripe_pre</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">stripe</span> <span class="o">=</span> <span class="n">stripe_pre</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">unwanted_string_tail</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">stripe</span></code></pre></figure>

<p>Once we get our title, there are a few things that need to be done with it:</p>

<p>First, our <em>’ -.- ‘</em> separator needs to be replaced with the CSV separator needed for the scrobbling file. <em>’;’</em> is a considerably safer choice than a comma, because commas are very frequent in tags while semicolons are not.</p>

<p>Next, there needs to be a timestamp at the beginning of each scrobble to indicate when that scrobble took place. Python’s datetime module provides a simple solution for this.</p>

<p>After we get the datetime object, we format it according to a practical specification. Year is followed by month, which is then followed by day, then after a semicolon we get the current hour and minute of the day. A semicolon at the end prepares the string for the actual tag stripe.</p>

<p>Finally, we add the timestamp to the tag content, remove unnecessary stuff from the end of the string, and return the complete scrobble line.</p>

<p>After defining functions, we form starting variables:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">csv_file_location</span> 	<span class="o">=</span> <span class="sh">'</span><span class="s">d:/doc/scrobbles/2024.csv</span><span class="sh">'</span>
<span class="n">time_played_current</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time_played_past</span> 	<span class="o">=</span> <span class="mi">9999</span></code></pre></figure>

<p><em>csv_file_location</em> needs to be set to a path on your drive where the scrobbling file is to be stored.</p>

<p>Setting up <em>time_played_past</em> and <em>time_played_current</em> is just priming the pump before the action starts. In other words, we set up initial values for the script to have something to work with.</p>

<p><em>time_played_past</em> is needed once when the script initiates. For playback logging to be registered, the variable stores 9999 “seconds” so when we begin playback, <em>time_played_current</em> has a lower number. This means a track has been changed - if the same track were still playing, that number would go up, not down.</p>

<p>The number going down indicates changing of the track or restarting the currently played track. One way or another, it is a sign to add that new item to our scrobble history.</p>

<p>We use <em>while True:</em> for the contained code to run infinitely. We want the script to be always on and always listening for new playback changes.</p>

<p>Because the code is simple and extremely lightweight, it doesn’t slow down the system by any noticeable amount. In fact, it probably wouldn’t even if we were running it 500 times in parallel.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">foobar_title</span> <span class="o">=</span> <span class="nf">get_window_title_contains</span><span class="p">(</span><span class="sh">'</span><span class="s"> [foobar2000]</span><span class="sh">'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">foobar_title</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">-.-</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">foobar_title</span><span class="p">:</span></code></pre></figure>

<p>The script begins to move by checking if among all currently opened windows there is one whose title contains the string representing foobar2000.</p>

<p>Just to make sure that we don’t have accidentally opened a website or a document which contains that very string and could fool our script, we add a second condition for further execution - the string has to contain our chosen tag separator in foobar2000. A situation where both of these conditions are met and the string captured is still not a foobar2000 player is probably as improbable as winning the national lottery five times in a row ;)</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">playback_time_pre</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">[^-]+$</span><span class="sh">'</span><span class="p">,</span> <span class="n">foobar_title</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">playback_time</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\d\d?:\d\d</span><span class="sh">'</span><span class="p">,</span> <span class="n">playback_time_pre</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">time_played_current</span> <span class="o">=</span> <span class="nf">convert_minsec_to_sec</span><span class="p">(</span><span class="n">playback_time</span><span class="p">)</span></code></pre></figure>

<p>As explained before, in order to compare current playback time with the last tick, we need to feed time to a function that does just that. For that, we first extract the part of the string which contains playback time and then extract it from that line.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">time_played_current</span> <span class="o">&lt;</span> <span class="n">time_played_past</span><span class="p">:</span>
	<span class="n">csv_stripe</span> <span class="o">=</span> <span class="nf">foobar_title_to_csv_stripe</span><span class="p">(</span><span class="n">foobar_title</span><span class="p">)</span>
	<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">csv_file_location</span><span class="p">,</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
		<span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">csv_stripe</span><span class="si">}</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span></code></pre></figure>

<p>Making changes to a scrobble file is guarded behind a condition that the currently played file plays for fewer seconds than our last stored state.</p>

<p>When the condition is met, we use the function that converts the foobar2000 title to a final CSV-ready stripe (line). After that, we append that stripe to our file whose location is stored in <em>csv_file_location</em>.</p>

<p>The program cycle then needs two more actions to complete.</p>

<p>First, the variable <em>time_played_past</em> needs to get the value of <em>time_played_current</em>. In other words, our variable to which we will compare the next playback state needs to be updated.</p>

<p>Finally, we order the script to sleep for 3 seconds. The amount of time which is best depends on the habits of a particular user. One person changes tracks 20 times per minute, another presses play after adding a big playlist and never tinkers with playback until the program is shut down. The value must be chosen depending on your habits.</p>

<p>Below is the code for the entire script. If you don’t know how to make the script run permanently in the background in Windows, please refer to a guide which I will be adding shortly.</p>

<h2 id="code-for-the-entire-script">Code for the entire script</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="n">pygetwindow</span> <span class="k">as</span> <span class="n">gw</span><span class="p">,</span> <span class="n">re</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">time</span> <span class="kn">import</span> <span class="n">sleep</span>


<span class="k">def</span> <span class="nf">get_window_title_contains</span><span class="p">(</span><span class="n">partial_title</span><span class="p">):</span>
	<span class="n">windows</span> <span class="o">=</span> <span class="n">gw</span><span class="p">.</span><span class="nf">getAllTitles</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">partial_title</span> <span class="ow">in</span> <span class="n">title</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
			<span class="k">return</span> <span class="n">title</span>


<span class="k">def</span> <span class="nf">convert_minsec_to_sec</span><span class="p">(</span><span class="n">minsec</span><span class="p">):</span>
	<span class="n">seconds</span> <span class="o">=</span> <span class="n">minsec</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
	<span class="n">minutes</span> <span class="o">=</span> <span class="n">minsec</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
	<span class="n">seconds</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
	<span class="n">minutes</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">minutes</span><span class="p">)</span>
	<span class="n">seconds_full</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">minutes</span> <span class="o">+</span> <span class="n">seconds</span>
	<span class="k">return</span> <span class="n">seconds_full</span>


<span class="k">def</span> <span class="nf">foobar_title_to_csv_stripe</span><span class="p">(</span><span class="n">foobar_title</span><span class="p">):</span>
	<span class="n">csv_ready</span> <span class="o">=</span> <span class="n">foobar_title</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> -.- </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">;</span><span class="sh">'</span><span class="p">)</span>
	<span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
	<span class="n">formatted_time</span> <span class="o">=</span> <span class="n">current_time</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y.%m.%d;%H:%M;</span><span class="sh">'</span><span class="p">)</span>
	<span class="n">stripe_pre</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">formatted_time</span><span class="si">}{</span><span class="n">csv_ready</span><span class="si">}</span><span class="sh">'</span><span class="p">[:</span><span class="o">-</span><span class="mi">14</span><span class="p">]</span>
	<span class="n">unwanted_string_tail</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">;\d?\d:\d\d$</span><span class="sh">"</span><span class="p">,</span> <span class="n">stripe_pre</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">stripe</span> <span class="o">=</span> <span class="n">stripe_pre</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">unwanted_string_tail</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">stripe</span>



<span class="n">csv_file_location</span> 	<span class="o">=</span> <span class="sh">'</span><span class="s">d:/doc/scrobbles/2024.csv</span><span class="sh">'</span>
<span class="n">time_played_current</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time_played_past</span> 	<span class="o">=</span> <span class="mi">9999</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	<span class="n">foobar_title</span> <span class="o">=</span> <span class="nf">get_window_title_contains</span><span class="p">(</span><span class="sh">'</span><span class="s"> [foobar2000]</span><span class="sh">'</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">foobar_title</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">-.-</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">foobar_title</span><span class="p">:</span>
		<span class="n">playback_time_pre</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">[^-]+$</span><span class="sh">'</span><span class="p">,</span> <span class="n">foobar_title</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">playback_time</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\d\d?:\d\d</span><span class="sh">'</span><span class="p">,</span> <span class="n">playback_time_pre</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">time_played_current</span> <span class="o">=</span> <span class="nf">convert_minsec_to_sec</span><span class="p">(</span><span class="n">playback_time</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">time_played_current</span> <span class="o">&lt;</span> <span class="n">time_played_past</span><span class="p">:</span>
			<span class="n">csv_stripe</span> <span class="o">=</span> <span class="nf">foobar_title_to_csv_stripe</span><span class="p">(</span><span class="n">foobar_title</span><span class="p">)</span>
			<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">csv_file_location</span><span class="p">,</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">csv_stripe</span><span class="si">}</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>

		<span class="n">time_played_past</span> <span class="o">=</span> <span class="n">time_played_current</span>
	<span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></code></pre></figure>]]></content><author><name>Chris</name></author><category term="audio" /><category term="python" /><summary type="html"><![CDATA[Writing a local Windows audio scrobbler]]></summary></entry><entry><title type="html">How to Run Python Scripts in the Background</title><link href="https://www.devkoala.com/2023/how-to-run-python-scripts-in-the-background.html" rel="alternate" type="text/html" title="How to Run Python Scripts in the Background" /><published>2023-04-11T14:21:01+02:00</published><updated>2023-04-11T14:21:01+02:00</updated><id>https://www.devkoala.com/2023/how-to-run-python-scripts-in-the-background</id><content type="html" xml:base="https://www.devkoala.com/2023/how-to-run-python-scripts-in-the-background.html"><![CDATA[<h1 id="how-to-run-python-scripts-in-the-background">How to Run Python Scripts in the Background</h1>

<p>There are two type of system scripts.</p>

<ol>
  <li>
    <p><strong>Interactive Scripts</strong>: These are scripts that we run with a program or terminal window open. For these scripts, we often want detailed output so we can closely monitor what the script is achieving and ensure it encounters no obstacles.</p>
  </li>
  <li>
    <p><strong>Background Scripts</strong>: These are silent partners, running in the background and performing minor tasks quietly, such as periodic data downloading, database updating, headline sniffing, file maintenance, etc.</p>
  </li>
</ol>

<p>For the latter, having a window open the entire time for something that is just supposed to work quietly is a waste of visual space. We want it to be as detached and absent as possible.</p>

<p>Below, I will show a simple way to set up just that. The example will be a Python script run through Task Scheduler.</p>

<h2 id="basics">Basics</h2>

<p>To run scripts “silently”, we need a few things things:</p>

<h3 id="--python">- Python</h3>

<p>Download the latest version from the <a href="https://www.python.org/downloads/" target="_blank">official website</a>.</p>

<h3 id="--virtual-environment">- Virtual Environment</h3>

<p>Although it’s not required, using a virtual environment is a very important habit. Virtual environments are self-contained environments that have a specific version of Python and a specific set of modules installed, tailored for one particular job.</p>

<p>If we install all the modules to the default system version of Python, the module list might grow exponentially, slowing down Python software execution. Additionally, we might encounter compatibility issues. If something happens to the core system Python, it could cause a system-wide meltdown.</p>

<p>To maintain order, simplicity, ease of access, and stability, it’s best to install a virtual environment for every different task or group of tasks our programs will be performing.</p>

<p><strong>venv</strong>, a virtual library for Python, comes with Python itself, so there is no need to install it separately.</p>

<ul>
  <li>Open a terminal (cmd or PowerShell) and navigate to the directory where you want to store your virtual environments. Choose a location that is convenient and logical.</li>
  <li>In the terminal, run: <em>python -m venv</em> followed by the name you want to give to the virtual environment. For example: <em>python -m venv mybackup</em>.</li>
  <li>To use the virtual environment, you need to activate it. When you create an environment using venv, a folder with that name is created, containing a <em>Scripts</em> folder, which contains an activate file. To start the script, run the command: <em>source path/to/venv/myvenvname/Scripts/activate</em> where myvenvname is the name of your virtual environment. Alternatively, you can navigate to the venv’s <em>Scripts</em> folder and run <em>source activate</em>.</li>
  <li>Once the virtual environment is activated, install all the modules required by the script you want to run in Task Scheduler. Open your script file(s) and review all the imports. Some of them are built-in (installed with Python), while others need to be downloaded externally. Download the external modules with the command <em>pip install</em> followed by the module name.</li>
</ul>

<p>Once you are finished, you can exit the virtual environment by typing <em>exit</em> in the console window. Don’t worry - once everything is set up, you won’t have to manually enter the virtual environment for Task Scheduler to execute it.</p>

<h3 id="--pyw-python-file">- <em>.pyw</em> Python file</h3>

<p>Python files can be saved with two file extensions: <em>.py</em> and <em>.pyw</em>. The latter, <em>‘w’</em> stands for <em>‘Windows’</em>.</p>

<p>The code within the file gets executed the same way. The difference is that the extra <em>‘w’</em> tells Windows that the script is intended to run in the graphical interface, i.e., without a terminal window present during execution.</p>

<h3 id="--task-scheduler">- Task Scheduler</h3>

<p>Ideally, background scripts initiate on predefined triggers or run whenever the system is on, without the need to start them manually each time.</p>

<p>Task Scheduler is a refined piece of software included with Microsoft Windows, specifically designed to run tasks according to various criteria.</p>

<p>I will skip the detailed explanation and go straight to the point. However, if you need a detailed guide on its features and settings, <a href="/2024/task-scheduler-guide.html" target="_blank">here is a link</a> to a Task Scheduler guide.</p>

<h2 id="create-a-script-task-in-task-manager">Create a script task in Task Manager</h2>

<ul>
  <li>Make sure that the Python script you are adding has a <em>.pyw</em> extension instead of <em>.py</em>.</li>
  <li>Open Task Scheduler by pressing <em>Start</em> and typing the initial letters of <em>task scheduler</em> until auto-complete suggests it.</li>
  <li>Select a <em>Create Task</em> action.</li>
  <li>In the <em>General</em> tab, give your task a name. Choose something short but descriptive. The name is required, and while the description is optional, it’s worth adding if you have many tasks or similar tasks.</li>
  <li>In the <em>Triggers</em> tab, add one or more triggers. For example, if you want the script to run at 10 AM every day, select <em>On a schedule</em> and specify the hour.</li>
  <li>In <em>Actions</em> tab, specify the tasks to be executed. Click the <em>New</em> button.
<img src="https://www.devkoala.com/assets/img/articles/how-to-run-python-scripts-in-the-background/pyw.png" alt="Task Scheduler: adding a pyw script" /></li>
  <li>Click <em>Browse</em>, navigate to the location of your virtual environment where the script is supposed to run. In the directory containing the activate file, there are <em>.exe</em> files for different Python executables. Locate <em>pythonw.exe</em> and select it. Be careful not to select <em>python.exe</em> by accident. The <em>‘w’</em> letter at the end is important, as we need to run a <em>‘.pyw’</em> file with <em>‘pythonw.exe’</em> for the script to run entirely in the background.</li>
  <li>In the Add arguments (optional) field, paste the full path to the script you want to run.</li>
</ul>

<p>And that’s it! There are many other settings worth checking out to tailor the script to your needs, but the defaults are sensible and will generally not prevent the script from working.</p>

<p>It is generally worth manually starting the task after adding it to verify that it’s working before leaving Task Scheduler.</p>]]></content><author><name>Chris</name></author><category term="python" /><category term="windows" /><summary type="html"><![CDATA[How to Run Python Scripts in the Background]]></summary></entry><entry><title type="html">How to Run Scripts with Mouse Gestures</title><link href="https://www.devkoala.com/2021/how-to-run-scripts-with-mouse-gestures.html" rel="alternate" type="text/html" title="How to Run Scripts with Mouse Gestures" /><published>2021-08-22T10:00:01+02:00</published><updated>2021-08-22T10:00:01+02:00</updated><id>https://www.devkoala.com/2021/how-to-run-scripts-with-mouse-gestures</id><content type="html" xml:base="https://www.devkoala.com/2021/how-to-run-scripts-with-mouse-gestures.html"><![CDATA[<h1 id="how-to-run-scripts-with-mouse-gestures">How to Run Scripts with Mouse Gestures</h1>

<h2 id="mouse-gestures-an-underutilized-feature">Mouse Gestures: An Underutilized Feature</h2>

<p>Mouse gestures have always been an underutilized feature. Similar to Virtual Reality helmets, they are undeniably useful and have the potential to become universal. However, unlike VR, which has seen substantial investment, mouse gestures remain relatively neglected. Even today, internet browser manufacturers hesitate to implement them in the base code, let alone provide a system-wide solution. Notably, Apple’s Hot Corners is an example of something similar being implemented, but it is not a comprehensive solution.</p>

<p>Casual users benefit the most from mouse gestures since they eliminate the need to remember text commands or navigate through menus. Instead, users can simply press a button and perform a hand movement. This feature can also be incredibly beneficial for programmers and IT administrators. Gone are the days when most tasks were performed in a terminal window, making the mouse redundant. Nowadays, many tasks are executed in graphical interfaces.</p>

<p>A particularly powerful and simple action is starting a script with a mouse gesture. In just half a second and with our eyes closed, we could perform tasks such as:</p>

<ul>
  <li><strong>Preparing the work environment</strong>: Starting multiple apps, resizing windows, and closing unnecessary processes.</li>
  <li><strong>Clipboard management</strong>: Displaying a list of recent clipboard items for quick pasting.</li>
  <li><strong>Screenshot tool</strong>: Capturing a screenshot and saving it to a predefined folder.</li>
  <li><strong>New email shortcut</strong>: Starting an email client and opening a new message window with the recipient pre-filled.</li>
  <li><strong>VPN connect/disconnect</strong>: Quickly connecting to or disconnecting from a VPN.</li>
  <li><strong>Task automation</strong>: Running a predefined automation script, such as moving files to a backup location.</li>
  <li><strong>Lock screen</strong>: Immediately locking the computer screen for security.</li>
</ul>

<p>And much more. Imagination is the limit, as scripts can do almost anything, and modern Windows operating systems are very receptive.</p>

<p>All we need for these tasks is a desktop mouse gesture program.</p>

<h2 id="about-strokesplus">About StrokesPlus</h2>

<p><img src="https://www.devkoala.com/assets/img/articles/how-to-run-scripts-with-mouse-gestures/strokes-plus.png" alt="StrokesPlus main window" /></p>

<p>Since mouse gestures are not very popular, there aren’t many apps offering this functionality. Those that do often have slow development cycles. The app I recommend is <strong>StrokesPlus</strong>. Although it hasn’t received an update in almost a year, it remains a complete and bug-free software.</p>

<p>It’s best to download it directly from its website at <a href="https://www.strokesplus.net/Downloads" target="_blank">strokesplus.net</a>.</p>

<p>The program is simple yet powerful. It offers keyboard modifiers for every action, not just a single optional modifier for all actions. For instance, a right button swipe to the right could perform one action, a left button swipe to the right could do another, and a shift-right button swipe to the right could do yet another.</p>

<p>This dramatically increases the number of actions you can assign, unlike most other mouse gesture programs that force users to come up with complex and difficult-to-execute gestures. The more complex the gesture, the higher the chance of executing an incorrect action.</p>

<p>StrokesPlus uses Lua as a scripting language, allowing for a wide range of actions. The most basic use is generating keystrokes, such as <em>ctrl+w</em>, frequently used to close the current tab in programs. But it offers much more! Lua can interact with Windows APIs, enabling file operations, window management, process management, and system volume control.</p>

<p>Thanks to AI tools like ChatGPT, you don’t even need to know Lua or delve into Windows API commands to program these tasks. Simply ask, and you shall receive.</p>

<h2 id="setting-up-a-mouse-gesture-to-start-a-python-script">Setting Up a Mouse Gesture to Start a Python Script</h2>

<ul>
  <li>
    <p><strong>Install StrokesPlus</strong>: After installation, restart your PC if necessary. Run the application. Its default state is minimized, with only a tray icon visible. Open the application window by clicking the tray icon.</p>
  </li>
  <li>
    <p><strong>Create a new action</strong>: In the StrokesPlus.net interface, go to the Actions tab. Click the New Action button.</p>
  </li>
  <li>
    <p><strong>Name the action</strong>: Give your action a descriptive name, such as My First System-Breaking Python Script.</p>
  </li>
  <li>
    <p><strong>Assign a gesture</strong>: Assign a mouse gesture to this action by drawing in the gesture box.</p>
  </li>
  <li>
    <p><strong>Add Lua script</strong>: In the Lua Script tab for the action, add the following Lua code to run your Python script through the virtual environment’s Python interpreter:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">acShellExecute<span class="o">(</span><span class="s2">"C:</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">myenv</span><span class="se">\\</span><span class="s2">Scripts</span><span class="se">\\</span><span class="s2">python.exe"</span>, <span class="s2">"C:</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">your</span><span class="se">\\</span><span class="s2">script.py"</span>, <span class="s2">""</span>, <span class="s2">""</span>, <span class="s2">"SW_SHOWNORMAL"</span><span class="o">)</span></code></pre></figure>

<p>Make sure to replace <em>“C:\path\to\myenv\Scripts\python.exe”</em> with the actual path to the Python executable in your virtual environment, and <em>“C:\path\to\your\script.py”</em> with the actual path to your Python script.</p>

<h2 id="troubleshooting-tips">Troubleshooting tips</h2>

<ul>
  <li><strong>Permissions</strong>: Ensure your Python script has the necessary permissions to execute.</li>
  <li><strong>Paths</strong>: Double-check all paths in your Lua script for accuracy.</li>
  <li><strong>Virtual Environment Activation</strong>: Ensure you are using the correct path to the virtual environment’s Python executable.</li>
</ul>

<p>Keep in mind that if you already use mouse gestures in browsers, they may conflict with system-wide StrokesPlus gestures. It’s best to disable the browser add-ons. Additionally, while playing games, you might accidentally trigger mouse gestures. If those gestures correspond to in-game keyboard shortcuts, you could disrupt your gaming session. It’s best to either close StrokesPlus before playing, or add the game to <em>Ignore List</em> in StrokesPlus</p>

<h2 id="final-thoughts">Final thoughts</h2>

<p>It is not recommended to bind critical scripts to mouse gestures. Always consider the consequences of accidentally starting a script, whether by you or someone else using your computer. Assume it will happen one day, and if the negative consequences are too high, avoid creating that gesture.</p>

<p>Ideal candidate scripts are those that:</p>

<ul>
  <li>Do not require any fixing or require minimal fixing if executed accidentally.</li>
  <li>Are repetitive and need to be done frequently.</li>
  <li>Were previously executed manually in a cumbersome and inconvenient way.</li>
</ul>

<p>Find a script that fits one or more of these criteria, and you’ll save a lot of time and wonder how you lived without custom gesture executing it!</p>

<p>I still believe that one day gestures will become a crucial part of navigation in future interfaces, whatever those interfaces may be, but for now, even though mouse gestures are not popular, it doesn’t stop us from using them and enjoying all the power they have to offer.</p>]]></content><author><name>Chris</name></author><category term="interface" /><category term="windows" /><summary type="html"><![CDATA[How to Run Scripts with Mouse Gestures]]></summary></entry><entry><title type="html">Guide to responsive design tools in CSS</title><link href="https://www.devkoala.com/2021/guide-to-responsive-design-tools-in-css.html" rel="alternate" type="text/html" title="Guide to responsive design tools in CSS" /><published>2021-02-01T10:13:28+01:00</published><updated>2021-02-01T10:13:28+01:00</updated><id>https://www.devkoala.com/2021/guide-to-responsive-design-tools-in-css</id><content type="html" xml:base="https://www.devkoala.com/2021/guide-to-responsive-design-tools-in-css.html"><![CDATA[<h1 id="guide-to-responsive-design-tools-in-css">Guide to responsive design tools in CSS</h1>

<p>Before smartphones became popular, almost entire web browsing traffic was on PCs.</p>

<p>Despite only one device needing to be taken in consideration when designing a website, web designers still didn’t have an easy task on their hands. Some people had a 800x600 screen resolution, others 1024x768, others 1280x1024. Different viewports needed to be addressed and, as opposed to today, there weren’t exactly that many tools at our disposals to properly do so.</p>

<p>One of the early heavily abused properties for the task was min/max-height/width, both present in CSS 1.0 specification. It allowed to create different limitations to items. This helped in adjusting page elements to different screens.</p>

<p>While helping to <em>“constrain”</em> items, it was obviously limited. Ok, the element can be <em>this</em> big, but then what?</p>

<h2 id="css-21-additions">CSS 2.1 additions</h2>

<p>2010 was probably the year when smartphones entered internet browsing market big time. In that year, <em>3.8%</em> traffic was mobile. Those devices that now everyone <a href="https://blabbermouth.net/news/max-cavalera-why-i-dont-have-a-cell-phone">except Max Cavalera</a> has in a pocket were beginning to serve more and more extra roles outside of plain talking. And the most important of its all new emerging roles was browsing the web.</p>

<p>In the year 2011, <em>8.5%</em> web traffic was mobile. More than double the amount in one year! One year later it went up to <em>13.2%</em>, a <em>55%</em> increase. A team behind CSS knew well where the market is going and that it’s their responsibility to addressed the needs related to this market expansion.</p>

<p>One of the most notable additions in CSS 2.1 was the support for <strong>media queries</strong>. Media queries allowed developers to apply different styles based on the characteristics of the device or viewport, such as screen resolution, orientation, and aspect ratio. This feature enabled the creation of responsive layouts that could adapt to different screen sizes and orientations.</p>

<p>While being a game changer, using media queries still produced many problems.</p>

<p>First one that comes to mind is that in order to accomodate all more and less popular screen sizes, plenty of rules has to be written. It can take quite some time to set everything up. And when making some major redisigning, often all of that has to be changed! So the code is annoying to both navigate and change.</p>

<p>Second problem is that designing based on media queries often leaves annoying blindspots. When resizing browser on a high resolution desktop, entire design <em>“snaps”</em> once crossing a defined threshold (for examle <em>min-width</em> of <em>1024px</em>).</p>

<p>One motivation for such setup could be that at 1024px the font size/image size/side panel size etc. becomes so unbearable to watch that it has to be changed to a new now-good-looking arrangement. But what if someone has high desktop resolution and browser occupying only part of the screen?</p>

<p>That person’s browser can then have the width right below the min-width property, right where the design is the ugliest, right before the change for the better. And so it could be a visitor left in a state of disgust and leaving the site ASAP before even beginning to read the content.</p>

<p>We can mitigate that by creating more rules, more trigger points. This makes the blindspots less ugly, but also requires more time for code creation and maintenance.</p>

<p>After CSS 2.0, the number of different types of developments that needed to be done became so big that <strong>World Wide Web Consortium</strong> started splitting more and more of the work. By the time of CSS 2.1 birth in 2001, a small portion of modules was already going their own separate ways, despite the standard still having a formal version.</p>

<h2 id="css-30-additions">CSS 3.0 additions</h2>

<p>In 2005, the CSS3 module publishing process began, with individual modules like Selectors, Color, Values and Units, etc. being developed and released independently.</p>

<p>Version 3.0 brought some game-changing additions to responsive design. The two biggest ones were <strong>Flexbox</strong> and <strong>Grid</strong>.</p>

<p>Flexbox enabled super-easy creation of 1D page elements while CSS Grid 2D structures. Both made many tasks trivial and targetted one of the biggest problems of html development: endless mazes of <em>&lt;div&gt;</em> tags in code.</p>

<p>With Flexbox, splitting a horizontal space among few different objects was as simple as appending to each object’s CSS properties <em>‘flex:’</em> followed by a number. And those proportions were of course scaling infinitely in both ways.</p>

<p>Grid, on the other hand, became the go-to tool for creating a more complex designs of big news outlets, magazinet and the likes, where multiple different cubes can be stacked next to each other in different proportions with very little code to manage it.</p>

<p>The Units section of W3C also introduced units frequently used in responsive design - <em>vw</em> (short of <em>viewport width</em>), <em>vh</em> (<em>viewport height</em>), and <em>rem</em> (<em>root em</em>).</p>

<p>Of the three, viewport width is the most important one in the context of this article. Having viewport width as direct reference point for size of any element on page is really a game changer.</p>

<p>CSS 3.0 introduced a plenthora of various functions, some of which very potent in responsive design. One notable example is <strong>calc()</strong> function. On paper, it’s just a calculator, so what could it possibly offer when creating websites that need so scale perfectly?</p>

<p>Adding fixed value to a relative one can make sure we can get infinitely scaling <em>vw</em> element if need be while also setting up a base provided by fixed value. Relative unit doesn’t amount to much in tiny viewport, but fixed value covers for that shortcoming. And so we have a solid size for small displays while the relative one keeps us safe no matter how large viewport gets.</p>

<p>Sometimes the “growth curve” is not to our liking (the object gets big too fast or too slow as the screen gets wider etc.). Adjusting this curve with extra parameters using calc() function can help there. It can be time consuming to find two or three values which scale perfectly across the whole spectrum, but at the end it allows perfect scaling across the whole viewport spectrum, impossible to achieve with single unit, whichever we may choose for the task.</p>

<p><em>CSS Values and Units Module Level 4</em> standard introduced multiple wonderful tools, like the <strong>min()</strong> and <strong>max()</strong> functions, which seek to replace or compliment media queries.</p>

<p><em>min()</em> allows to choose the smallest number from the list of different numbers. When giving the function vw, percentage values etc. often we don’t consider the fact that someone out there might be watching the webpage in resolution multiple times bigger than we think our max users are having.</p>

<p>The website (or some of its elements like text) need to stop growing at some point in order not to start looking grotesque. min() enables us to set things up using relative units, with a sanity value (like <em>3000px</em>) to make sure that the element never stretches more than that.</p>

<p>As the function looks for the smallest parameter, when our responsive design element reaches 3001px, it becomes bigger than 3000px and so no longer selected as parameter.</p>

<p><em>max()</em> does exactly the same thing in opposite direction, as the name implies, and often serves to capture the limit of the shrinking instead of stretching.</p>

<p>The <em>clamp()</em> function takes a more sophisticated approach to controlling values. Instead of managing extremes on just one side of the spectrum, it covers both sides.</p>

<p>It takes three parameters: a minimum value, the value itself, and a maximum value. The middle value is relative, and the minimum and maximum values provide limits that the function enforces. If the value falls below the minimum, it is clamped to the minimum value. If it falls above the maximum, it is clamped to the maximum value.</p>

<p>Another useful addition to CSS is the <picture> tag. It acts as a container for multiple images. Instead of resizing one large image across all viewports and penalizing users with smaller screens by making them download a larger-than-necessary image, different versions of the image can be selected based on conditions similar to media queries.</picture></p>

<p>This allows the appropriate image to be loaded depending on the screen size.</p>]]></content><author><name>Chris</name></author><category term="css" /><category term="html" /><summary type="html"><![CDATA[Guide to responsive design tools in CSS]]></summary></entry><entry><title type="html">JPG compression guide for Linux</title><link href="https://www.devkoala.com/2020/jpg-compression-guide-for-linux.html" rel="alternate" type="text/html" title="JPG compression guide for Linux" /><published>2020-09-16T08:01:21+02:00</published><updated>2020-09-16T08:01:21+02:00</updated><id>https://www.devkoala.com/2020/jpg-compression-guide-for-linux</id><content type="html" xml:base="https://www.devkoala.com/2020/jpg-compression-guide-for-linux.html"><![CDATA[<h1 id="jpg-compression-guide-for-linux">JPG compression guide for Linux</h1>

<h2 id="basics">Basics</h2>

<p>Almost all jpg files out there are compressed to some extent. The compression is on a scale of 1 to 100, 1 being most compressed (do not ever go that low!), 100 meaning no compression.</p>

<p>Recompression reduces image quality. Exactly how much it varies. With some images, recompressing 100 times with the same compression level will barely decrease image quality, but other times even a single recompression can introduce ugly artifacts.</p>

<p>That’s why recompression should only be done when changing the compression level by a considerable amount, and hopefully as rarely as possible.</p>

<p>Another important thing is to recompress only to lower levels. Recompressing to a higher level means the image will take more hard disk space, but at best it will still only look as good as it did before the last compression.</p>

<p>Image quality can’t be magically improved by changing to a higher compression level, just like details of a completely blurred image can’t be made sharp just by increasing image sharpness—the sharp contours and exact object colors just aren’t there behind the image, waiting to be exposed.</p>

<p>Recompression to the same quality is almost always a bad idea. If the previous compressor did a terrible job, the damage is done already. We can only go lower on the scale and test if it’s possible to save space while doing a minimum of extra damage.</p>

<p>Usually, the only good reason to recompress is to reduce image quality so it can take less space on the hard disk, thus it can take less space, load faster, and eat less bandwidth. If you don’t have these concerns, don’t compress. You can always compress later, but when image details are lost, they are lost forever.</p>

<h2 id="finding-out-compression-level-of-an-image">Finding out compression level of an image</h2>

<p>You can check the level of jpg file compression by installing Image Magick (more about it soon) and then running this shell command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">identify <span class="nt">-format</span> <span class="s1">'%Q'</span> filename.jpg</code></pre></figure>

<p>Replace filename with the name you want to inspect.</p>

<p>It is extremely useful for scripting purposes to be able to check for image compression level.</p>

<p>Let’s say we run a forum website with many users who upload many images. We don’t want those images to be just left there on the server.</p>

<p>Going down from 100 compression (no compression) to just 95 rarely produces visible image problems, but it can drastically reduce size!</p>

<p>So, in whichever programming language we’re running on a server, we can write a script to get each incoming image’s compression level and if it’s above a desired number, recompress it with jpegoptim to whichever we want.</p>

<p>You can also check compression level in graphical programs. Look for ‘image properties’ or something similar in your program’s drop-down menus. Some graphic editors ask for compression level each time we save a new image or even re-save an already existing one.</p>

<p>By default, the slider in some of those programs shows the program default for the file extensions, but in others, it shows current image compression. You have to find out for yourself how your program behaves.</p>

<h2 id="saving-uncompressed-image-compressing-with-another-tool">Saving uncompressed image, compressing with another tool</h2>

<p>We’ve established that we want to compress as few times as possible and select the best tool for the job. Let’s go through an example to illustrate that approach.</p>

<p>In another post, I presented a script that (in short) captures screen content to a file. It uses the import tool, which is part of Image Magick.</p>

<p>If you don’t understand part of its command, check the linked article where it is explained in detail. Here, we will use it in concert with another tool.</p>

<p>There are other command line programs whose only purpose is to compress images. For the jpg format, probably the most popular one right now is jpegoptim — and that’s what we’re going with.</p>

<p>If we really want the best image quality for the size, we need to use a specialized tool like that, instead of assuming that the program that produced the image has a good algorithm. It might, it might not. We will use it in this short tutorial.</p>

<p>Jpegoptim probably doesn’t ship with any Linux distro, so you have to install it manually. First, try from your distro’s official repository.</p>

<p>Now, if we order import to save the screen capture to a .jpg file, it will compress it to 85, which is the program default.</p>

<p>But since jpegoptim will do a better job optimizing its quality, we don’t want import to compress it at all. The first compression might seriously worsen image quality.</p>

<p>We can change import’s compression level to any other percentage we want by appending the import command with ‘-quality 95’ (or any other number). We need to order it not to compress. We do that by adding ‘-quality 100’ to the command.</p>

<p>Jpegoptim generally has two modes. The first, default one, optimizes the image, leaving its compression level unchanged. It does not recompress (so no quality loss), but only improves compression to squeeze more out of it.</p>

<p>The second we invoke with the ‘-m’ option. Executing this command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">jpegoptim <span class="nt">-m70</span> filename.jpg</code></pre></figure>

<p>will recompress filename.jpg with 70% compression, using its own optimized algorithm.</p>

<p>Let’s take a real-life use case. We have a monitor that displays some sort of statistics. Every hour, we need to capture the content of that monitor to a file for reference.</p>

<p>We only want to have the latest reference image, so we want it to always write to the same file, overwriting its content every hour.</p>

<p>Depending on some conditions, we might want to rename the file by hand and move it to another folder with images. And since in that folder files will stay forever, we need to take precautions so one day this folder’s size does not become a problem. We need to compress.</p>

<p>Our Bash script file only needs to contain two lines, plus the path to the interpreter on line one:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/usr/bin/bash</span>
import <span class="nt">-window</span> root <span class="nt">-crop</span> 2560x1440+0+0 <span class="nt">-quality</span> 100 /path/to/filename.jpg
jpegoptim <span class="nt">-m90</span> /path/to/filename.jpg</code></pre></figure>

<p>Import captures our 1440p left-most monitor’s screen and saves it to an uncompressed jpg file. Jpegoptim then finishes the work by compressing it.</p>

<p>To generate that image every hour, we save that file and end its name with ‘.sh’. We then go to a command line window, start editing the current user’s crontab file with ‘crontab -e’ and paste that line into it:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">0 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>	/path/to/our/script.sh</code></pre></figure>

<h2 id="png-instead-of-jpg">PNG instead of JPG</h2>

<p>What if we want to save to a PNG file instead? In some cases, it’s a better choice. If the image contains transparent background, it’s mandatory since PNG supports it and JPG does not.</p>

<p>Since it’s a popular format, there are many compression tools written for it as well.</p>

<p><strong>pngquant</strong> is one such tool. It is easy to install on many platforms and is even present in Ubuntu’s official repository. To save it to a PNG file, we need to do two things:</p>

<ol>
  <li>
    <p>Change the file extension from ‘<em>.jpg</em>’ to ‘<em>.png</em>’ in the line with import command.</p>
  </li>
  <li>
    <p>Replace the jpegoptim command line with this one (remember to change image paths):</p>
  </li>
</ol>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pngquant <span class="nt">--quality</span> 90 <span class="nt">--speed</span> 1 <span class="nt">--force</span> <span class="nt">--output</span> /path/to/filename.png /path/to/filename.png</code></pre></figure>

<p>The quality setting is self-explanatory. We set speed to 1 (slowest, but gives the best results).</p>

<p>The ‘force’ option is needed here, as the default pngquant behavior is that it doesn’t overwrite images, and we order the program to save to the same file that it reads from. If we don’t specify the output file, it appends its ending to a filename, and for this example, we need to overwrite the source file.</p>]]></content><author><name>Chris</name></author><category term="cli" /><category term="images" /><category term="linux" /><summary type="html"><![CDATA[JPG compression guide for Linux]]></summary></entry><entry><title type="html">Converting date to ISO 8601 in Python</title><link href="https://www.devkoala.com/2020/converting-date-to-iso8601-in-python.html" rel="alternate" type="text/html" title="Converting date to ISO 8601 in Python" /><published>2020-09-07T11:53:01+02:00</published><updated>2020-09-07T11:53:01+02:00</updated><id>https://www.devkoala.com/2020/converting-date-to-iso8601-in-python</id><content type="html" xml:base="https://www.devkoala.com/2020/converting-date-to-iso8601-in-python.html"><![CDATA[<h1 id="converting-date-to-iso-8601-in-python">Converting date to ISO 8601 in Python</h1>

<h2 id="why-use-iso-8601">Why use ISO 8601?</h2>

<p>No matter which area a programmer works in, he most likely has to deal with dates in some way. Even writing a basic application log benefits from stamping information with dates, so we know when a potential problem occurred, etc.</p>

<p>Unfortunately, dates are a tricky subject. They are often an extra feature that just needs to work but doesn’t. And they can fail for many reasons.</p>

<p>One of the main reasons is incompatibility between different date formats. Sometimes, the month is a word; sometimes it’s a number. The standard order of year, month, and day differs from one country to another.</p>

<p>When the month is a number and it’s 12 or lower, it can be confused with the day number, making it difficult to verify which is which. One month has 30 days, another has 31. February has 28 days… but only 3 years out of 4. All this needs to be considered when dealing with dates.</p>

<p>To alleviate the pain from some of these problems, ISO 8601 was introduced. It is an international standard, an exact way of writing date and time so that there is no confusion.</p>

<p>Having all dates in one format is important for your own projects. When dates are always written the same way, there is no need to convert anything, and they are compatible with each other for future use by default.</p>

<p>It is also important externally. When someone else needs to process them, there is no need to verify what is what or format the string to make it compatible with another company’s internal formatting standard.</p>

<p>Choosing ISO 8601 is also very convenient for the programmer. Most frameworks, modules, etc., that deal with dates use it as the default standard and force the user to first convert the input data string to ISO 8601 before further processing. Such is the case with SQLite, Pandas, Django, and many more.</p>

<p>It is always best practice to stick to one data formatting standard whenever possible. And since ISO 8601 is the most popular standard for date formatting in the world, it is most convenient to stick to it. It makes our dates most compatible with other dates “out there,” saving us from many potential headaches in the future.</p>

<h2 id="what-needs-does-this-converter-address">What needs does this converter address?</h2>

<p>Unfortunately, there is no one correct way to write a converter. It all depends on the context in which it needs to be used, and based on that, the optimal behavior can be different.</p>

<p>For example, in some cases, it is crucial that failure to convert produces an error and instantly stops the program from running to not pollute the data with pseudo-dates or empty strings which have to be addressed quickly to avoid breaking something else.</p>

<p>Other times, it is mandatory that the service continues working and errors are handled silently and gracefully. There is no right or wrong way to write it; it’s all context-dependent.</p>

<p>The converter function below behaves as follows:</p>
<ul>
  <li>Deals just with date, not date and time</li>
  <li>Does not require hint parameters to know the format, it tries to guess which is which</li>
  <li>Returns None on failure, does not break whatever’s running it</li>
  <li>When month and day are both numbers, it assumes that month is always the digit on the left side, and day on the right</li>
  <li>The year is always a four-digit number</li>
  <li>The month can be either a number, or a word</li>
  <li>A day can be either a one-digit number or a two-digit number</li>
  <li>There can be no day, but month and year both have to be present</li>
</ul>

<p>Make sure that a converter you need meets all the criteria above, or that you have fixes for when it doesn’t.</p>

<p>Below I break apart the code. If you just want the entire thing to copy-paste, click <a href="#full_code">here</a>.</p>

<h2 id="code-breakdown">Code breakdown</h2>

<blockquote>
  <p>def toiso8601(date):</p>
</blockquote>

<p>The converter is best written as a function, convenient to keep in a separate Python helper file and import as needed. It takes date, i.e., a string hopefully containing all the ingredients we need.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">def</span> <span class="nf">month_to_digit</span><span class="p">(</span><span class="n">month_as_word</span><span class="p">):</span>
		<span class="n">months_full</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">january</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">february</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">02</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">march</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">03</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">april</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">04</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">may</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">05</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">june</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">06</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">july</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">07</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">august</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">08</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">september</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">09</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">october</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">10</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">november</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">11</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">december</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">12</span><span class="sh">'</span><span class="p">}</span>
		<span class="n">months</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">jan</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">feb</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">02</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mar</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">03</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">apr</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">04</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">may</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">05</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">jun</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">06</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">jul</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">07</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">aug</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">08</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sep</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">09</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">oct</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">10</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">nov</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">11</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dec</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">12</span><span class="sh">'</span><span class="p">}</span>
		<span class="n">month_as_word</span> <span class="o">=</span> <span class="n">month_as_word</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">month_as_word</span> <span class="ow">in</span> <span class="n">months_full</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
			<span class="n">month_final</span> <span class="o">=</span> <span class="n">months_full</span><span class="p">[</span><span class="n">month_as_word</span><span class="p">]</span>
		<span class="k">elif</span> <span class="n">month_as_word</span> <span class="ow">in</span> <span class="n">months</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
			<span class="n">month_final</span> <span class="o">=</span> <span class="n">months</span><span class="p">[</span><span class="n">month_as_word</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">ERROR: not a valid date. month word unknown</span><span class="sh">'</span><span class="p">)</span>
			<span class="n">month_final</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">return</span> <span class="n">month_final</span></code></pre></figure>

<p>First, we write a sub-function that converts the month, written as a word, to a number (still written as a string). This sequence exists twice in our code, so there is no point repeating the whole thing. Instead, we make a function of it and call it when needed.</p>

<p>There are two types of month words popular in writing dates in English. The first one is full words, the second the first 3 letters of each word. In ISO 8601, the month is a two-digit number. So we have to convert.</p>

<p>For that, we have two dictionaries, one for each type. The keys are the month-words, the values are numbers to which they convert.</p>

<p>If it feels right, you can also create one dictionary and test for the full name against the full key name or for the first three letters of the parsed string against the first three letters of each dictionary key, saving us from the need to create the second dictionary. It reduces redundancy in our code but makes the script perform worse.</p>

<p>Notice that the numbers are in quotes. They are strings, first because ‘01’, ‘02’, ‘03’ etc. are not numbers understandable by Python, and second because the entire process is taking string input and outputting another string. There is no reason to switch to any other data type at any point, as sooner or later it would have to be converted back into a string.</p>

<p>If conversion fails (i.e., the word doesn’t match the month name in either dictionary), we set month_final to None. At the end of our function, we make a condition that year, month, and day all have to be set, and only then do we generate and return the final date. Otherwise, we’d let some gibberish word posing as a month pass through to the final string.</p>

<p>There is no ISO 8601 date without a year, and setting it to some default is risky business. You could, for example, decide to go with ‘0000’. If such a year has no reason to exist in our data (let’s say we have a movie database), setting it to such would conform to the ISO 8601 standard while giving us valuable information that that particular piece of data is missing.</p>

<p>In some datasets, the data has to exist, even if our database tool of choice allows setting datetime fields to be empty. This would force us to use a solution like that.</p>

<p>Since for my use case it’s not a problem, if a four-digit number indicating the year is not found, the function informs about the problem, returns None, and that’s the end of it.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="n">year</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">\d\d\d\d</span><span class="sh">'</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">year</span><span class="p">:</span>
		<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">ERROR: not a valid date. year missing</span><span class="sh">'</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="n">year</span> <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></code></pre></figure>

<p>The last line of that chunk of code extracts the string from a regex object. If we had done it earlier (not knowing if the regex found anything), pointing to a sometimes non-existing item would throw an error. That behavior we do not want, as it would force us to use it inside a ‘try’ clause.</p>

<p>After setting up a year variable, we now need to delete this number from the date string and only seek in that new variable. Otherwise, it would extract sub-numbers from it as potential month and day numbers.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="n">date_no_year</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="sh">''</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
	<span class="n">month_day</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sh">'</span><span class="s">\d\d?</span><span class="sh">'</span><span class="p">,</span> <span class="n">date_no_year</span><span class="p">)</span>
	<span class="n">month_word</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">[A-Za-z]{3,}</span><span class="sh">'</span><span class="p">,</span> <span class="n">date_no_year</span><span class="p">)</span></code></pre></figure>

<p>Then, we proceed to look inside that newly cut string for the word indicating month and as many sets of digits as we can find. The combination of these two findings are the basis for our final assessments of what data we have and how to process it.</p>

<p>For that, we use the regex module’s findall and search functions. Both month and day can be single or double-width strings (hence ? by the second one, meaning “0 or 1 of it”). Month words only contain letters, and all the words in both dictionaries are of 3+ length. {3,} means “minimum 3, maximum unspecified. So equal to or higher than 3”. Just like with Python slices when we skip one side.</p>

<p>Being specific here is important. If someone surprises our converter with a peculiar date, like 1969x05x20, our function would still work and omit ‘x’ separators, as they are only of length 1. Not demanding three or more letters in a word, those x-es would be added needlessly as separate ‘month or day’ items and cause the script to fail to fulfill its duty and return None.</p>

<p>Now we get into different scenarios.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">if</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">month_day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="n">month</span> <span class="o">=</span> <span class="nf">month_to_digit</span><span class="p">(</span><span class="n">month_word</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">day</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">day</span> <span class="o">=</span> <span class="sh">'</span><span class="s">0</span><span class="sh">'</span> <span class="o">+</span> <span class="n">day</span></code></pre></figure>

<p>First is the case of month being a word (as in containing letters, not in the regex sense, where digits also qualify as word characters) and month_day search returning only one object.</p>

<p>If we have a year, some word, and some digit, it is safe to assume that that word is the month and the digit is the day. So we set up both variables, giving us a first potential complete set of year, month, and day variables.</p>

<p>The last two lines are important. ISO 8601 does not accept single-digit numbers, neither for date nor for time. If the input format is ‘Sep 1, 1995’, the day needs ‘0’ in front of 1.</p>

<p>Because strings are iterable in Python, it is very easy to check for their length, and if it’s 1 (which means the number is most likely 1-9 with no 0 in front), we add it and the day variable is complete.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">elif</span> <span class="ow">not</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">month_day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="n">month</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">day</span> <span class="o">=</span> <span class="sh">'</span><span class="s">01</span><span class="sh">'</span></code></pre></figure>

<p>The first alternative check is for no word indicating the month and just a single digit found. In most cases, when we only have a year and a single number, that single number is the month. Nobody writes the year and day of a month that is not specified.</p>

<p>In rare cases, this extra number means the day of the year. This converter is not equipped to deal with such a scenario, and if it is indeed what you have to deal with, you’d have to use Python’s datetime module to convert it to a final date. It is easily achievable once you know this primary tool for dealing with dates in Python.</p>

<p>In many scenarios, when the day is not found, we might want the whole date to be invalid. For my use, I still need the date, which is only used for getting approximate guesses to another object with another date (the ones with the smallest timedelta between them being paired), so a few days off are much less hurtful than not having a date at all.</p>

<p>If you want to not return any date if the day is missing, it is easy to change in this function. Because final date generation will fail if the year, month, or day is not set, all you have to do is change “day = ‘01’” to “day = None” in two places.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">elif</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">month_day</span><span class="p">:</span>
		<span class="n">month</span> <span class="o">=</span> <span class="nf">month_to_digit</span><span class="p">(</span><span class="n">month_word</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">day</span> <span class="o">=</span> <span class="sh">'</span><span class="s">01</span><span class="sh">'</span></code></pre></figure>

<p>Next is a straightforward case, where we have a word for the month, but no extra number that would represent the day. Here, again we blindly set the day to the first of the month.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">elif</span> <span class="ow">not</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">month_day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
		<span class="n">month</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">day</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">day</span> <span class="o">=</span> <span class="sh">'</span><span class="s">0</span><span class="sh">'</span> <span class="o">+</span> <span class="n">day</span></code></pre></figure>

<p>Lack of a word representing the month and two sets of digits indicates both month and day being numbers. As mentioned in the function summary, this part assumes the month number is to the left of the day number. You can reverse this order by setting month to month_day[1] and day to month_day[0].</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">else</span><span class="p">:</span>
		<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">ERROR: not a valid date</span><span class="sh">'</span><span class="p">)</span>
		<span class="n">year</span> <span class="o">=</span> <span class="bp">None</span></code></pre></figure>

<p>Finally, we write what to do if all our previous conditions fail. If we got to it, this means that either of these is true:</p>
<ul>
  <li>A word representing the month was not found, and the regex was not able to fetch any numbers from the string, leaving us with no data to work with.</li>
  <li>Besides the year, there were more than two other numbers.</li>
</ul>

<p>Three digits make it impossible to assess which one is the month and which one is the day. Usually, it means that the string we got is not a date at all, or a date with some unfortunate extra luggage.</p>

<p>One way or the other, under this circumstance, it is best not to make wild guesses and instead call it quits. The print statement will inform us about the problem in the terminal window. Setting year to None will make the final condition fail, as it tests for the presence of year, month, and day. None is faulty in Python, indicating failure, and so the condition is not met.</p>

<p>The final piece of our code checks for the presence of all objects and constructs a string from them.</p>

<p>The last return is silent and applies only when that condition is not met. Every function in Python returns None, if not specified elsewhere. Here, we want to return date, but only if we have all the ingredients. If not, there are no final return instructions, which means the function will return ‘None’.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">if</span> <span class="n">year</span> <span class="ow">and</span> <span class="n">month</span> <span class="ow">and</span> <span class="n">day</span><span class="p">:</span>
		<span class="n">final_date</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="sh">'</span>
		<span class="k">return</span> <span class="n">final_date</span></code></pre></figure>

<p>In other words, the final lines could be more redundantly written this way:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="k">if</span> <span class="n">year</span> <span class="ow">and</span> <span class="n">month</span> <span class="ow">and</span> <span class="n">day</span><span class="p">:</span>
		<span class="n">final_date</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="sh">'</span>
		<span class="k">return</span> <span class="n">final_date</span>
	<span class="k">return</span> <span class="bp">None</span></code></pre></figure>

<p>First return reached instantly ends the function, and so it reaches ‘return None’ only if year, word and month are not set to anything truthy.</p>

<p>And here is the entire code:<a id="full_code"></a></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="kn">import</span> <span class="n">re</span>
	<span class="k">def</span> <span class="nf">toiso8601</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
		<span class="k">def</span> <span class="nf">month_to_digit</span><span class="p">(</span><span class="n">month_as_word</span><span class="p">):</span>
			<span class="n">months_full</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">january</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">february</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">02</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">march</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">03</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">april</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">04</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">may</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">05</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">june</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">06</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">july</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">07</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">august</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">08</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">september</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">09</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">october</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">10</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">november</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">11</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">december</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">12</span><span class="sh">'</span><span class="p">}</span>
			<span class="n">months</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">jan</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">01</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">feb</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">02</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mar</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">03</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">apr</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">04</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">may</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">05</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">jun</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">06</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">jul</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">07</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">aug</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">08</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sep</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">09</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">oct</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">10</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">nov</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">11</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dec</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">12</span><span class="sh">'</span><span class="p">}</span>
			<span class="n">month_as_word</span> <span class="o">=</span> <span class="n">month_as_word</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">month_as_word</span> <span class="ow">in</span> <span class="n">months_full</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
				<span class="n">month_final</span> <span class="o">=</span> <span class="n">months_full</span><span class="p">[</span><span class="n">month_as_word</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">month_as_word</span> <span class="ow">in</span> <span class="n">months</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
				<span class="n">month_final</span> <span class="o">=</span> <span class="n">months</span><span class="p">[</span><span class="n">month_as_word</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">ERROR: not a valid date. month word unknown</span><span class="sh">'</span><span class="p">)</span>
				<span class="n">month_final</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="k">return</span> <span class="n">month_final</span>

		<span class="n">year</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">\d\d\d\d</span><span class="sh">'</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">year</span><span class="p">:</span>
			<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">ERROR: not a valid date. year missing</span><span class="sh">'</span><span class="p">)</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="n">year</span> <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="n">date_no_year</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="sh">''</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>

		<span class="n">month_day</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sh">'</span><span class="s">\d\d?</span><span class="sh">'</span><span class="p">,</span> <span class="n">date_no_year</span><span class="p">)</span>
		<span class="n">month_word</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">[A-Za-z]{3,}</span><span class="sh">'</span><span class="p">,</span> <span class="n">date_no_year</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">month_day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">month</span> <span class="o">=</span> <span class="nf">month_to_digit</span><span class="p">(</span><span class="n">month_word</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">day</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">day</span> <span class="o">=</span> <span class="sh">'</span><span class="s">0</span><span class="sh">'</span> <span class="o">+</span> <span class="n">day</span>
		<span class="k">elif</span> <span class="ow">not</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">month_day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">month</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">day</span> <span class="o">=</span> <span class="sh">'</span><span class="s">01</span><span class="sh">'</span>
		<span class="k">elif</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">month_day</span><span class="p">:</span>
			<span class="n">month</span> <span class="o">=</span> <span class="nf">month_to_digit</span><span class="p">(</span><span class="n">month_word</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">day</span> <span class="o">=</span> <span class="sh">'</span><span class="s">01</span><span class="sh">'</span>
		<span class="k">elif</span> <span class="ow">not</span> <span class="n">month_word</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">month_day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">month</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">day</span> <span class="o">=</span> <span class="n">month_day</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">ERROR: not a valid date</span><span class="sh">'</span><span class="p">)</span>
			<span class="n">year</span> <span class="o">=</span> <span class="bp">None</span>

		<span class="k">if</span> <span class="n">year</span> <span class="ow">and</span> <span class="n">month</span> <span class="ow">and</span> <span class="n">day</span><span class="p">:</span>
			<span class="n">final_date</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="sh">'</span>
			<span class="k">return</span> <span class="n">final_date</span></code></pre></figure>]]></content><author><name>Chris</name></author><category term="date" /><category term="iso8601" /><category term="python" /><summary type="html"><![CDATA[Converting date to ISO 8601 in Python]]></summary></entry><entry><title type="html">CMUS music player review</title><link href="https://www.devkoala.com/2020/cmus-music-player-review.html" rel="alternate" type="text/html" title="CMUS music player review" /><published>2020-09-01T11:03:28+02:00</published><updated>2020-09-01T11:03:28+02:00</updated><id>https://www.devkoala.com/2020/cmus-music-player-review</id><content type="html" xml:base="https://www.devkoala.com/2020/cmus-music-player-review.html"><![CDATA[<h1 id="cmus-music-player-review">CMUS music player review</h1>

<div class="sidenote">
version reviewed: 2.7.0<br />
installed on: Linux Mint 19
</div>

<p><img src="https://www.devkoala.com/assets/img/articles/cmus-music-player-review/cmus1.png" alt="CMUS library view" /></p>

<p>CMUS is probably the most popular terminal-based music player for Unix operating systems. The competition is almost non-existent, and even from that small pool, some applications do not look to meet the same needs CMUS addresses (some basically play a single specified track and that’s it).</p>

<p>Despite being very satisfied with my previous player, DeadBeef, I was eager to look for something that could be fully controlled from within by keyboard, and thus free up various system-wide (and Ranger-wide) playback shortcuts with one application shortcut, and give all the commands from inside the program inside the terminal window. Which, of course, has its advantages over graphical interface.</p>

<p>DeadBeef already comes chock-full of keyboard shortcuts, including specialized ones that you’ll struggle to find in most music players, like remove currently played file from disk, or look it up on last.fm. Spoiled for choice, I was coming with high expectations.</p>

<h2 id="views">Views</h2>

<p>By pressing numbers 1-7, we switch between different tabs, which in CMUS are called ‘views’. First one is tree view (aka. library), second is sorted library, third is playlist, fourth is queue. We get three options for three different scenarios, depending on how long do we plan on keeping the file on the list:</p>
<ul>
  <li>library is for long-term  additions that is supposed to reflect all the music we have on disk (or at least the part of it which we want to have quick access to)</li>
  <li>playlist is for ‘current’ use</li>
  <li>queue is a list that takes priority - whatever is added there is going to be played immediately after the currently played track and only after</li>
</ul>

<p>Majority of users will spend majority of time either in library view, or playlist view, depending of course on which they find more convenient.</p>

<p>The librarians will find separate playback queue extremely useful. Since in library, an order of tracks is predetermined on loading, it is very convenient to press whatever key we have bound to the win-add-q command to add it to music queue. This way, we use library to play entire albums and in between we add to queue whatever music we scavenge outside the current album’s directory.</p>

<p>On the other hand, using queue for playlistians is not as useful. In playlist, we set whatever order of tracks played ourselves. And so queue view doesn’t address the natural limitations of library view. We end up splitting our playlist into two for no reason.</p>

<p>A better solution for people who use playlist as their primary queuing tool would be to have an extra ‘insert into playlist after currently played track” command for cmus-remote. Unfortunately, you’d struggle to find it in almost all music players out there and it’s a very handy feature that would completely remove any need to use queue view for most playlist users.</p>

<p>The version 2.7.0, which I installed from official repository, is missing an ability to set the default view on program startup. As a playlist user, I have to manually focus the player and press ‘3’ on each system startup to switch from an empty library window to playlist view.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/cmus-music-player-review/cmus2.png" alt="CMUS playlist view" /></p>

<p>An auto-detect feature would be nice as well - if playlist is populated, but library is empty, start with playlist view. If both are empty, but queue contains tracks, focus queue view on startup.</p>

<p>An auto-switch to view when adding to it would also solve this problem, but is missing too. (edit: in version 2.8.0, there is a new cmus command ‘start_view’, which probably solves the problem)</p>

<h2 id="speed">Speed</h2>

<p>One of the reasons why someone might want to switch to a terminal-based application is speed. Perhaps the user has a very old laptop and wants to make it usable, but the modern bulky applications slow it down too much.</p>

<p>With music players for people with large music libraries on their hard drives, this is very relevant. Many programs perform well with single playlists and up-to-medium-size libraries, but once the going gets tough, they can start forever and crush often, searching is extremely slow etc.</p>

<p>A program that is displayed in a terminal emulator window does not necessarily have to be fast (Kakoune being a good example), but most of the time switching to a text interface helps to increase system performance on old computers.</p>

<p>Here, CMUS delivers. It can handle ridiculously large playlists with ease. Searching works like a breeze, too. If performance is your primary concern, switching to CMUS is definitely worth considering.</p>

<h2 id="key-bindings">Key bindings</h2>

<p>Just like so many other terminal applications, CMUS is somewhat inspired by VIM when it comes to navigation. You can move up and downwith home row keys, quit the program with ‘:q’.</p>

<p>It is possible to move selected track up or down, switch views, increase/decrease volume, pause/unpause, control playback, mark tracks for operations, execute shell commands and more.</p>

<p>Together with options, keybindings reside in a config file. Conveniently, this file is editable from inside the program as one of views. You can reach it by pressing ‘7’. Lines are highlighted same as tracks are in other views. We roll down or up to reach the line we want to edit and press enter. A colon followed by the command to change set to current value is displayed at the bottom, enabling us to edit.</p>

<p>The operation needs to be finished by pressing enter. That means if we screw up, we have to correct, because whatever we accept with enter will stay in config.</p>

<p>The program checks for validity of input only for options. If it gets the value that doesn’t exist, it reverts to last correct setting. If we edit a boolean field and we insert non-bolean value, whatever that is, it will display an error and then set the option’s value to false, since we just fed it something that is not allowed, which boolean translates to false. It doesn’t matter if it was true or false before.</p>

<p>When binding keys to commands, there is no check. Any gibberish will be accepted and the error will show only after pressing the bound key.</p>

<h2 id="string-formatting">String formatting</h2>

<p>CMUS offers surprising flexibility in what is displayed in each field in each view (and in program title, which is very important for some applications).</p>

<p>It gives access to many tag variables and lets the user format them in any way he sees fit. Here, the program is as good as they come. You’d struggle to find a music player that gives you more freedom to shape the way tag data is displayed.</p>

<h2 id="tag-viewingediting">Tag viewing/editing</h2>

<p>And yet, it doesn’t have an option to display full tag, even just for mp3 files.</p>

<p>Tag-editing duties are usually split between two programs: tag editor for bulk operations and music player for single corrections. I see a misspelled artist name in player window, I edit this file to make a quick correction in-place.</p>

<p>No need to start another terminal session, find the directory and write full command pointing to a file just to remove one ‘d’ from the end of an artist string.</p>

<p>You could argue that perhaps the user should leave tag editing duties to his tag editor, but that would be sacrificing convenience for ideology. And it’s a poor argument, the file tag is read and displayed by the program already. Whatever tags are read by the player are then potentially scrobbled. It’s not a separate case.</p>

<p>But there is no argument for not letting the user view the tag in full. This is really a basic, elemental feature that, just like equaliser, everybody takes for granted in a music player. I doubt many people, when researching a potential change of their music software, checks for the presence of the two, instead taking it for granted.</p>

<p>Notice that there is a a plugin for editing tags, just like there is for playing a random track. How good it is, I don’t know. Even if they are great, this functionality needs to be integrated into the base software.</p>

<h2 id="file-browsing">File browsing</h2>

<p>Ranger offers too much convenience with file management to delegate some of it to CMUS’ file browser. For me, it’s most convenient to select either single track, multiple tracks, or a folder and then order CMUS to either play or enqueue it (append it to the bottom of current playlist).</p>

<p>People who operate this way will find file browser useless, and in CMUS that browser is a first-class citizen, by default available by pressing ‘5’ on keyboard. Built browser will always have its limitations compared to a piece of software that is dedicated to just this task. Same for people who navigate their hard drives directly in command line, spoiled for endless customization possibilities.</p>

<p>Of course, it’s not a problem in any way, as it doesn’t take any unnecessary space and the access to it can be unbound. Whoever likes using it has the option to use it. And some internal file pointer had to be developed anyway.</p>

<h2 id="issuing-commands-from-outside-cmus">Issuing commands from outside CMUS</h2>

<p>Here’s where things get complicated. Every time CMUS starts, a tool named cmus-remote starts as well. It enables us to control playback, volume control and few other things through a socket, from outside the program. This way, we can, for example, configure custom wireless remote to jump between tracks on a playlist without the need to do it on keyboard.</p>

<p>List of commands is short, and they are stripped in functionality compared to how other players react to particular commands.</p>

<p>For example, the convention is that using the equivalent of ‘cmus-remote filename.mp3’ (directly giving the program a file to work with) does all these:</p>
<ul>
  <li>stops current playback</li>
  <li>clears current playlist</li>
  <li>adds the pointed file</li>
  <li>focuses it</li>
  <li>starts playback</li>
</ul>

<p>In CMUS, this command just adds it to the bottom of whatever place we point to. (library, playlist or queue). It does not automatically switch, nor start playback. Whether switching 5-step convenient shortcut for a simple enqueue as default is a good choice, it is of course a matter of preferences. But the above is default in most applications for a reason. Most people prefer it that way.</p>

<p>Most CMUS commands refuse to offer anything extra. ‘–next’ doesn’t switch to next file and begin playback, it just switches to next file. This enables, for example, hopping 5 positions down without hearing the beginning of each track. But it is a very mild inconvenience to which people are used to and comes at a cost in other contexts.</p>

<p>Good design choice was to make ‘–next’ loop playlist. If we are at the last position in the playlist and give that command, it will start from the beginning. It saves us from traversing the entire playlist, or having a separate command to ‘go to top’.</p>

<p>I may be scanning an album for a good track I remember from youth. And so I have to issue –next command followed by –play command. Not this track. Another –next, another –play.</p>

<p>Most ‘nexts’ will most likely be the cases of “don’t want this, play me the next one” and here again we’re taxed with either double keystrokes for that common use case, or writing a separate shortcut/programming a separate button for it, One way, or the other, not good.</p>

<p>And things get more complicated.</p>

<p>Currently played track remains being one no matter what. If I pause playback and then clear whatever list I’m using for playback, it is somewhat logical that the paused track remains present and ready to continue playback, despite removing it from a list in which it was played. After all, we just paused it, the pointer sits somewhere between its start and end.</p>

<p><img src="https://www.devkoala.com/assets/img/articles/cmus-music-player-review/cmus3.png" alt="CMUS options view" /></p>

<p>But when the track is stopped and then the playlist is cleared, I am giving two commands to get rid of it, and yet when I add some new music and order a ‘–play’ command, it doesn’t start playing the first track from the freshly added ones. Instead, it starts the last played one from the beginning!</p>

<p>We are past it twice, already have a new batch ready for playback, but the player doesn’t want to let go of the past. Hence, instead of ‘cmus-remote –clear –play sometrack.mp3’, the command to produce behavior surely desired by majority of users has a mandatory ‘–next’. We have to use next to point to a first object from the list.</p>

<p>And since ‘next’ does not imply “and start playback”, if we want it, we have to ensure it. This litters large part of commands we’ll be issuing with ‘–play’, because if entire playlist had finished playing before we added new objects to it, the playback got stopped.</p>

<p>And in CMUS’ commands logic, if it was playing, switching tracks also continues playing. If it wasn’t, switching will not play. Switching is just switching. It doesn’t concern itself with playback status. Sounds good on paper, in practice it is a big annoyance.</p>

<p>Look at this command from DeadBeef:</p>

<blockquote>
  <p>–play-pause       Start playback if stopped, toggle pause otherwise</p>
</blockquote>

<p>Simple conditional logic and very convenient to use. In CMUS, if you say play, it plays if it isn’t already. You say stop, it stops if it’s not stopped already. You can toggle play with pause, but not with stop.</p>

<p>Another nice DeadBeef command absent in CMUS, particularly interesting for people who like to gamble, is:</p>

<blockquote>
  <p>–random           Random song in playlist</p>
</blockquote>

<p>’–seek’ is a single exception from the trend here. ‘seek +10’ will move the playback 10 seconds forward. We can seek backwards, for example with ‘seek -20’ to go twice that length in the opposite direction. A cherry on top is ‘seek 30’ (ie. without an operator in front) that enables us to jump to the 30th second of that track. A rare need for sure, but it’s always nice that we have this possibility.</p>

<p>Armed with so much flexibility, we can program a remote so that, for example, we have 3 seek options: +3s/-3s, +10s/-10s and +60s/-60s, giving us ingredients for a beefy remote.</p>

<h2 id="bugs">Bugs</h2>

<p>I did not have the opportunity to test CMUS on another machine, but on mine cmus-remote is extremely unreliable. I remotely control behavior of many programs and scripts and no software ever misbehaves, but CMUS does that all the time.</p>

<p>For some time, I thought there is something in the way program acts that I don’t understand, and so I tested various command combinations either as a single command, or in chain, but in the end everything failed. There was no reliable way to set cmus-remote for player control.</p>

<p>Ranger’s rifle.conf file contains default applications, so the file manager knows what to run when it encounters a file with a particular extension. We can set it up to do some action in CMUS, by executing ‘cmus-remote –clear –next –play – “$1”’. It clears the playlist, adds the track, switches to it and begins playback… or at least is does so some of the time.</p>

<p>Other times it adds the file, but does not switch to it and begins playback of the last-played track.</p>

<p>Because every ‘–next’ has a chance to miss bigger than even more adventurous RPG players might now want to gamble on, we can work around it by issuing the same command 4 times. I did test it 50 times and not once has it failed.</p>

<p>The problem arises when we are adding more than one file. With one, it’s not a problem since it either switches to that one file or not and ultimately it does. But with more than one, if each next succeeds, the selection travels further and further! Or at least it would, as even one ‘–next’ can move the cursor down by a random number.</p>

<p>Outside of this behavior, I haven’t encountered any other bugs, but this one alone makes the program completely unusable for me. If you decide to install it, right away go to a folder that contains multiple mp3 files, add them to playlist with ‘cmus-remote *’ and then start ordering ‘cmus-remote –next’ and see if it switches one position down each time.</p>

<p>Because if it doesn’t, well… good luck using the program ;)</p>

<h2 id="errors">Errors</h2>

<p>Errors are being displayed at the penultimate line in terminal window, by default in a dark red color (customizable, as colors of all other types of objects). Unfortunately, they don’t timeout, but stay there until we do anything inside the player window.</p>

<p>For playlist users, it is an annoyance, since they will be issuing most commands through cmus-remote and not touch terminal window directly.</p>

<p>You can play 10 albums, clear playlist 10 times, pause and unpause 100 times, and that ancient error will still be there for no reason.</p>

<h2 id="equalizer">Equalizer</h2>

<p>Again, for some reason, it’s missing! For music player, it is an absolute must. My headphones, for example, have a very bad default sound, but when tweaked in an equalizer, they can sound pretty good. Without the ability to play with frequencies, I am forced to use system-wide solutions, which I do not mind, but many people will.</p>

<p>Some of those solutions are obscure, some are hard to wrap head around, some produce artifacts and choke on sound when processor is running some taxing script.</p>

<p>PulseEffects is a very nice system set of tools (assuming someone uses PulseAudio) that contains an equalizer. Combining it with CMUS puts the user in a potentially weird space - a terminal-based music player backed by a graphical interface equalizer. Some choose terminal applications for the sake of them being terminal applications, in which case an extra graphical dependency make the switch a no-go.</p>

<p>For people willing to go this route, there may be a nasty surprise awaiting: PulseEffects fails to start as service on some distributions, requiring always having a graphical interface present to work.</p>

<h2 id="summary">Summary</h2>

<p>I had high hopes regarding CMUS, to the point of blindly switching to it from a program which, like already mentioned, I was very satisfied with. Unfortunately, its many problems and shortcomings made it impossible to use and after a week I gave up looking for solutions and went back to DeadBeef.</p>

<p>If on your machine cmus-remote commands work as intended and lack of equalizer and tag viewer/editor are irrelevant to you, then you may still want to try it out. Because outside of those issues, everything works like a charm.</p>

<p>Unfortunately, for me each one of those is a dealbreaker, and all together make CMUS unarmed for daily use.</p>]]></content><author><name>Chris</name></author><category term="audio" /><category term="cmus" /><category term="review" /><summary type="html"><![CDATA[CMUS music player review]]></summary></entry><entry><title type="html">Setting up single navigation pane in Ranger and why it’s a good idea</title><link href="https://www.devkoala.com/2020/setting-up-single-navigation-pane-in-ranger.html" rel="alternate" type="text/html" title="Setting up single navigation pane in Ranger and why it’s a good idea" /><published>2020-06-22T13:31:14+02:00</published><updated>2020-06-22T13:31:14+02:00</updated><id>https://www.devkoala.com/2020/setting-up-single-navigation-pane-in-ranger</id><content type="html" xml:base="https://www.devkoala.com/2020/setting-up-single-navigation-pane-in-ranger.html"><![CDATA[<h1 id="setting-up-single-navigation-pane-in-ranger-and-why-its-a-good-idea">Setting up single navigation pane in Ranger and why it’s a good idea</h1>

<p>By default, Ranger starts in a 3-pane view, which makes it unique but not very practical. Fortunately, this can be easily changed.</p>

<p><em>If you want to skip past gibberish and straight to solution, click <a href="#solution">here</a>.</em></p>

<p>For many years, I used Total Commander (the best file manager on Windows, or at least it used to be). Maximized, I had the classic two-pane design. One day, after buying my first full HD monitor (prehistoric times indeed), I opened the program and realized how much space I was losing by having that second pane. Half of my screen space, to be precise.</p>

<p>The truth is, in that classic Norton Commander design, half the screen is a glorified directory link. Yes, it can be used to compare folders or get a broader multi-directory view, which can help make sense of things.</p>

<p>But those are situational. Most of the time, one pane is important; the other just points to where to copy or move files from. It is a waste of space.</p>

<p>If reference is indeed its main purpose, the second pane might as well have a vertical split option and just hold stackable directory paths, with a pre-selected modifier and a randomly chosen key generated for each one to allow operations to/from these.</p>

<p>This would be a very good use of space and a real lifesaver when working on projects with complex directory structures. But one link taking up half of the screen estate?</p>

<p>This isn’t a problem if someone is used to having maximized applications and alt+tabbing between them. Plenty of that space will be wasted in most programs, but that won’t matter anyway since we decide to focus on one thing at a time. For many people, having multiple things at once makes them lose focus. That’s why distraction-free modes in editors are popular.</p>

<p>I often do multiple things at once and so I’d rather have them next to each other to be able to compare and rewrite code snippets, etc. Often, I have to run different scripts at once and need to see how they perform. And so every bit of space is important.</p>

<p>That’s why, after switching to Linux a few years back, I decided to look for a file manager that would just have one pane… and ended up using the one that has three!</p>

<p>In Ranger’s default view, the parent directory, which is always one keypress away, takes one-third of the space. Another shows the sub-directory. How often is that actually useful?</p>

<p>Some of the most advanced ‘navigators’ I’ve met just use the command line for their daily routines. They get zero information even about the current directory when navigating, and yet not only can they function, but they are absurdly fast with their operations.</p>

<p>Even when we actually need to scan a subfolder for the presence of a file or two, doing a recursive search will be much faster and much less eye-straining. A view of multiple directories at once is a gimmick, something that is there probably because it made the first program of its kind stand out from the crowd.</p>

<p>Since I absolutely loved Ranger from the get-go, I wasn’t going to let this spoil things. Even if there were no option to change it, I would probably stick to it still. Fortunately, this is not the case.</p>

<h2 id="editing-config-file">Editing config file</h2>

<p>Ranger stores configuration in two files: <em>rc.conf</em> (program settings, key bindings) and <em>rifle.conf</em> (file associations). We will be editing the first one.</p>

<p>You can find it in <em>~/.config/ranger</em> directory. If it’s not there, paste this command in console and run it:</p>

<blockquote>
  <p>ranger –copy-config=all</p>
</blockquote>

<p>Now both files should be there.</p>

<p>The first setting command that interests us is:</p>
<blockquote>
  <p>set viewmode [mode]</p>
</blockquote>

<p>This command takes one of two mode arguments:</p>
<ul>
  <li>miller: the one I mentioned, showing folder’s parent and children folder on both sides</li>
  <li>multipane: multiple unrelated directory views next to each other</li>
</ul>

<p>The multipane view puts an equation mark between tabs and panes. If there are no tabs, there is one pane. Every new tab creates a new pane, splitting the available space evenly between all displayed ones.</p>

<p>Another command complements it:</p>

<blockquote>
  <p>set column_ratios 1</p>
</blockquote>

<p>It takes 0 to 3 arguments. Giving it 4 or more is not considered properly in code. Setting it up in the config file and then starting Ranger runs it in a broken state.</p>

<p>For example, feeding it ‘1,2,1’ will set the parent and child directory panes to take 50% of the total window width, while the main window in which we navigate will occupy the other 50%. Keep in mind, though, that as of now, it only works for miller mode.</p>

<p>It would be convenient to set it to something like this:</p>

<blockquote>
  <p>set column_ratios 5,1</p>
</blockquote>

<p>If <em>multipane</em> was set, this command could only accept two arguments: the first one pointing to the relative size of the currently focused tab, the other to all other unfocused ones.</p>

<p>In <em>miller</em> mode, if we only give it one value, it will just give us one column. And since the one in which we traverse directories is the only one we can’t live without, it is set to be the only one remaining in such a case.</p>

<p>Notice that both setting <em>column_ratios</em> to <em>0</em> and not writing any number at the end will also give the same result.</p>

<p>So, if someone does not ever intend to use tabs, they might just set viewmode to multipane and be done with it, but there’s no need to do that. Today we don’t use it, maybe tomorrow we will. Let’s set it to <em>miller</em> and set <em>column_ratios</em> to <em>1</em>.</p>

<p>That’s not all, though. The problem arises when we hover over a file in Ranger. It’s going to get previewed. Now, half the screen will be occupied by a file each time we encounter a previewable one. Sometimes, that’s useful, but mostly it’s distracting.</p>

<p>The solution is to disable file previews:</p>

<blockquote>
  <p>set preview_files false</p>
</blockquote>

<p><a id="solution"></a></p>
<h2 id="summary">Summary</h2>

<ol>
  <li>Check if the file <em>rc.conf</em> exists in the path: <em>~/.config/ranger/</em>. If not, paste and execute the following command: <em>ranger –copy-config=all</em>. Now the file should be there.</li>
  <li>Open it in a text editor</li>
  <li>Add the following lines inside it:
    <ul>
      <li><em>set viewmode miller</em></li>
      <li><em>set column_ratios 1</em></li>
      <li><em>set preview_files false</em></li>
    </ul>
  </li>
</ol>

<h2 id="but-why-cripple-myself-with-one-pane-when-i-can-have-more">But why cripple myself with one pane when I can have more?</h2>

<p>If removing two panes will leave the user with empty space that they do not intend to populate in any way, it might be better to leave the default 3 panes on (unless the extra ones are distracting).</p>

<p>Even for people who don’t get much use from them but are used to having them always on, it can feel like the navigation is now crippled.</p>

<p>Don’t fret, though. First of all, we have tabs. Switching between them requires a single keystroke.</p>

<p>For copying files/directories, a popular approach is to:</p>
<ul>
  <li>Change path to the destination directory</li>
  <li>Open a new tab</li>
  <li>Go to some directory</li>
  <li>Select some objects</li>
  <li>Yank/copy them</li>
  <li>Close tab</li>
  <li>Paste</li>
</ul>

<p>Or reverse it if the file source directory and not the destination directory is where we want to do the next thing.</p>

<p>It takes the same amount of keystrokes to complete as doing that operation while jumping between panes. We just jump between tabs instead of panes. We lose visibility of a reference folder the entire time but require half the program space to complete it.</p>

<p>For diff purposes, tabbing is great too. We can, for example, check some potentially modified project folder against a backup of the same content and switch between them to quickly see if there are some differences in files. As they take turns occupying the same space, it will be easier to notice differences.</p>

<p>There are better solutions for scenarios like that, but for a quick check, it is often convenient to do it this way.</p>

<p>Second, we can simplify things further. We always move legally downloaded movies to the <em>‘movie’</em> folder, legally downloaded mp3 tracks to the ‘mp3’ folder, etc. Some folders receive a high amount of traffic. Almost everyone has a routine.</p>

<p>Many people who despise file managers and people who use them have bash aliases to folder paths set to allow easy moving. In Ranger, it is also very simple to do.</p>

<p>Ranger adopted one of Vim’s greatest tools - leader keys. No need to press a modifier key (of which there are few) and control its press and release in combination with another key to trigger some operation bound to that particular shortcut. Almost any key can lead, and it doesn’t have to be kept pressed.</p>

<p>And so, we can do this:</p>

<blockquote>
  <p>map mp shell mv %s /mnt/ssd/books/programming<br />
map mn shell mv %s /mnt/files/img/nakedpersons<br />
map ma shell mv %s /mnt/files/music/ambient</p>
</blockquote>

<p>We select all the books we want to move, then press ‘mp’ and we’re done. No need to go to any folder or open any tabs. A simple two-step operation.</p>

<p>If having two directories next to each other is a necessity at some point, nothing stops us from using a terminal multiplexer. So long as we remember that two separate Ranger instances can’t pass things between them, as Ranger doesn’t start a system daemon that could move that information. Another fantastic file manager, <a href="https://github.com/jarun/nnn">nnn</a>, has that functionality.</p>

<p>The same can be done with copying or any other shell command that takes a list of files and does something to them. Such is the amazing flexibility of the command line, and as a result, of programs that allow sending some input to it for further processing, like Ranger.</p>

<p>Another fantastic tool that supercharges single-pane navigation is history. In rc.conf, we can set:</p>

<blockquote>
  <p>map h history_go -1<br />
map H history_go 1</p>
</blockquote>

<p>By default, the <em>‘h’</em> key is used for navigation in Ranger, as it is in Vim. I am using the Colemak keyboard layout, so for me this key is free, which allows for a nice mnemonic binding. You can set it to any key you have available.</p>

<p>In a default config Ranger use, going back in history will mostly go to the directory from which we came, which will be one level higher or lower in the directory structure. Moving forward will do the opposite and will, of course, only work if we already went back in history (like redo in text editors).</p>

<p>But when we have all sorts of <em>map [key(s)] cd /some/path</em> shortcuts and jump between them, those two bindings become way more powerful. And we can bookmark folders on the fly as well (<em>‘m’</em> saves the current folder to bookmarks, tilde and <em>‘`’</em> keys open a list of bookmarked folders).</p>]]></content><author><name>Chris</name></author><category term="filemanager" /><category term="navigation" /><category term="ranger" /><summary type="html"><![CDATA[Setting up single navigation pane in Ranger and why it’s a good idea]]></summary></entry><entry><title type="html">Ranger configuration extras</title><link href="https://www.devkoala.com/2020/ranger-configuration-extras.html" rel="alternate" type="text/html" title="Ranger configuration extras" /><published>2020-04-01T22:43:18+02:00</published><updated>2020-04-01T22:43:18+02:00</updated><id>https://www.devkoala.com/2020/ranger-configuration-extras</id><content type="html" xml:base="https://www.devkoala.com/2020/ranger-configuration-extras.html"><![CDATA[<h1 id="ranger-configuration-extras">Ranger configuration extras</h1>

<p>Ranger is probably the single most powerful file manager application on any operating system.</p>

<p>It can be customized to the point of practically being a system-wide remote, one tool that can do anything. In this regard, it’s a very neat extension of the command line in Linux.</p>

<p>Because of that, almost every Ranger config file I’ve stumbled upon contains at least an interesting line or two. I’ve used the application for a few years already, but feel like there’s a lot that still needs attention. For example, a convenient way of dealing with archives of all sorts, or different file information views, depending on a particular need.</p>

<p>Below are some of my favorite additions to the <em>rc.conf</em> file. You can usually find it in <em>~/.config/ranger/</em> folder. If it’s not there, run this command in the command line: <em>ranger –copy-config=all</em>, which should create it.</p>

<p>Just paste the quoted lines wherever you see fit inside that file, but keep in mind that some of those commands invoke programs you will have to install.</p>

<h2 id="keyboard-layout-change">Keyboard layout change</h2>

<p>Using alternative keyboard layouts can be very painful for that person’s friends and family. If they sometimes need to operate on this person’s machine, after each session they might hate that person a little bit more.</p>

<p>Dvorak and Colemak are the unsung heroes of filesystem encryption, making all attempts to search YouTube or find something on Google fruitless, unless someone’s brain knows the layout. Even with keycaps being changed accordingly.</p>

<p>In order to help those poor people, we can set up an easy keyboard layout change to and from the basic QWERTY US layout to any we want. For that, we need to install <em>setxkbmap</em> with our package manager. For Ubuntu users, the command to paste in the command line is:</p>

<blockquote>
  <p>sudo apt-get install setxkbmap</p>
</blockquote>

<p>Then, insert these two lines to <em>rc.conf</em>:</p>

<blockquote>
  <p>map Ku shell setxkbmap -variant ,us<br />
map Kc shell setxkbmap -variant colemak</p>
</blockquote>

<p><em>‘Ku’</em> and <em>“Kc’</em> are my key combinations. You can set them to whatever you have unmapped. Then you need to restart Ranger, and whenever you want to change the layout, you just use those key combinations.</p>

<h2 id="mp3-file-tag-preview">MP3 file tag preview</h2>

<p>Sometimes, it is convenient to check the content of an MP3 tag. For example, a track we have on the hard drive might just have the artist and title in its filename, but we want to quickly check from which album it is or which year it was released.</p>

<p>Opening a browser for a Rate Your Music/Discogs/etc. check might take longer than getting to our music directory, quickly locating that file and pressing a key to see its tag contents.</p>

<p>For that, we’re going to need a CLI tag viewer. I highly recommend <a href="https://github.com/nicfit/eyeD3">eyeD3</a>, available both as a CLI app and an importable Python library. So, first in the command line:</p>

<blockquote>
  <p>sudo apt install eyed3</p>
</blockquote>

<p>And in Ranger config file:</p>

<blockquote>
  <p>map T shell clear; eyeD3 %s; read -p “———-press ENTER to continue———–”</p>
</blockquote>

<p>We are making a 3-step operation here:</p>
<ol>
  <li>Clear the terminal window, so that tag information can be the only thing displayed, so we don’t have to strain our eyes looking for it.</li>
  <li>Pass the selected file(s) to eyeD3 for tag preview.</li>
  <li>Use <em>read</em> to display some information.</li>
</ol>

<p>We need step 3, <em>read</em> with <em>-p</em> option (prompt). It waits for user input, enabling us to view the tag before coming back to Ranger.</p>

<p>Otherwise, we’d have to quit Ranger, display the tag, and start it again manually. Without the <em>-p</em> option, Ranger would display tag information and then instantly come back, requiring photographic memory coupled with Spiderman instincts to pick up the information we want. It would only be visible for a fraction of a second.</p>

<p>Notice that you can select multiple desired files, just like you normally mark them for operations in Ranger, and for each of them, tag information will be displayed in vertical order. Very handy.</p>

<h2 id="mp3-player-playback-control">MP3 player playback control</h2>

<p>In my opinion, it is much better to have system-wide playback control shortcuts than narrowing it down to a specific application. This way, we can change tracks while the monitor is off and never have to worry about what’s focused, even if we spend the majority of time in our file manager.</p>

<p>If you don’t have any free system-wide available key combinations for that purpose, you can let Ranger do the ordering. As long as your music player accepts playback commands from a terminal session (if it doesn’t, you need to change your music player).</p>

<p>Ordering the player to start playback of hovered/selected file(s) is as simple as setting up your default music application in Ranger’s <em>rifle.conf</em> file. But maybe we want to enqueue instead of play?</p>

<p>In this case, we have to check what playback control commands a particular player accepts. Most applications will give such information when starting up from a terminal window with <em>-h</em> (short for <em>‘help’</em>) added at the end.</p>

<p>In DeadBeef, enqueuing is done with the <em>–queue</em> parameter. The entire command looks like this:</p>

<blockquote>
  <p>map de chain shell deadbeef –queue %s; mark_files all=True val=False</p>
</blockquote>

<p>You need to replace it with your player of choice and its equivalent command (which might very well be exactly the same).</p>

<p>The second part is also important. Ranger has a nasty habit of leaving selections after operations and no way to change that behavior, as far as I know. There is an option to drop all selections when leaving a folder, but it doesn’t work in my version.</p>

<p>It is not a problem though because we can slap the above <em>mark_files</em> command whenever we want to unselect after an operation and skip it whenever we don’t, giving us full control.</p>

<h2 id="starting-twitch-streams">Starting Twitch streams</h2>

<p><em>youtube-dl</em> is a great tool to download YouTube videos, but it can also be used in concert with <a href="https://mpv.io/">MPV</a> to play its videos or playback Twitch streams.</p>

<p>For that, we of course first need to have both MPV and youtube-dl installed. Then, it’s as simple as adding one line for each stream to <em>rc.conf</em>:</p>

<blockquote>
  <p>map qan shell killall mpv; mpv https://www.twitch.tv/boxerpete &lt;/dev/null &amp;&gt;/dev/null &amp;</p>
</blockquote>

<p>The first part is optional and it kills all MPV instances. Since I want to play a stream now, first I want to end playback if something is already on, as I’m not going to watch two things at once.</p>

<p>Then I’m starting MPV with the Twitch streamer URL address. The player automatically invokes youtube-dl and begins stream playback.</p>

<p>In order not to freeze Ranger until stream playback is finished, which could be in 23 hours and 59 minutes in the case of a 24-hour stream, we need to order it to start as a separate process, hence the line ending.</p>

<p>Or are you like me and sometimes watch beautiful places on webcams while working, to cheat yourself that you’re not sitting inside a dark cave until the work is done?</p>

<blockquote>
  <p>map qge shell mpv https://www.youtube.com/watch?v=yMSc-qqW3To –no-audio –no-resume-playback &lt;/dev/null &amp;&gt;/dev/null &amp;</p>
</blockquote>

<h2 id="open-with">Open with…</h2>

<p>Default applications often don’t meet all our requirements for file handling. We might be using one application for the default action but also need another option for marginal cases.</p>

<p>Take images, for example. For casual users, the default action could be to open them in an image viewer. Sometimes, we might need to edit them, carve something out, and send it to someone? It’s good to prepare for such cases:</p>

<blockquote>
  <p>map wp shell pinta %s&lt;/dev/null &amp;&gt;/dev/null &amp;</p>
</blockquote>

<p><a href="https://www.pinta-project.com/">Pinta</a> is a simple image editor for Linux. It is an equivalent of the old <em>Paint Shop Pro</em> on Windows, back before Corel bought them.</p>

<p>For simple modifications like slicing particular areas out of an image, there is no point in starting any graphical powerhouse, as we’d waste a lot of time looking at the loading screen while the program computes stuff we will not need.</p>

<p>Maybe I need to open a file in an editor I’m not using daily:</p>

<blockquote>
  <p>map us shell subl %s</p>
</blockquote>

<p>Sublime Text spawns a separate process by default, so it doesn’t require a command ending to make it so.</p>

<p>Another use is to start a program with a specified geometry. I want to start the MPV player, but want it on my second 4:3 monitor:</p>

<blockquote>
  <p>map uv shell mpv –geometry=1280x1024+1920+0 %s&lt;/dev/null &amp;&gt;/dev/null &amp;</p>
</blockquote>

<p>We could add <em>–fs</em> before sending output to <em>/dev/null</em> to also start the program in full screen, but my experience is that it’s bugged and sometimes fullscreens on the first monitor, sometimes on the second.</p>

<p>Omitting it and specifying geometry is successful 100% of the time and there is no practical difference. It can be annoying if someone often click-drags the player window by accident (fullscreen prevents moving the window around). But in this case, it’s just better to disable it, with the exception of someone using a mouse and click-dragging the MPV window by accident. If that is your problem, just add this line to your <em>mpv.conf</em>:</p>

<blockquote>
  <p>no-window-dragging</p>
</blockquote>]]></content><author><name>Chris</name></author><category term="filemanager" /><category term="ranger" /><summary type="html"><![CDATA[Ranger configuration extras]]></summary></entry></feed>